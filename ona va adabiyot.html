<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ona tili va Adabiyot Ustozi| 6-sinf</title>
    <style>
        /* ================================================= */
        /* TUZATILGAN VA BARQAROR DARK MODE CSS QISMI */
        /* ================================================= */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Serif:wght@400;700&display=swap');
        
        :root {
            --primary-color: #00bcd4; /* Asosiy Yorqin Rang (Teal) */
            --primary-color-rgb: 0, 188, 212;
            --secondary-color: #0097a7; /* To'qroq Teal */
            --bg-color: #121212; /* Umumiy Kuchsiz To'q Fon */
            --chat-bg-light: #1e1e1e; /* Chat Box orqa foni */
            --bubble-user: #00bcd4; /* User xabari */
            --bubble-bot: #2c2c2c; /* Bot xabari */
            --text-color-light: #f0f0f0; /* Yorqin matn */
            --text-color-dark: #121212; /* To'q matn */
            --accent-color: #ff5722; /* Kichik aksent (Orange) */
            --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.5); 
            --chat-gradient: linear-gradient(135deg, var(--bubble-user), var(--secondary-color));
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color); 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: hidden;
            box-sizing: border-box;
            color: var(--text-color-light); 
        }

        .chat-container {
            width: 100%;
            max-width: 550px;
            background-color: var(--chat-bg-light);
            border-radius: 20px; 
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6); 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
            border: 1px solid #3a3a3a; 
            opacity: 0; 
            transition: opacity 0.5s;
        }

        .chat-header {
            background-color: #000000; 
            color: var(--primary-color);
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
            border-bottom: 3px solid var(--secondary-color);
        }
        .header-status {
            font-size: 13px;
            opacity: 0.8;
            font-weight: 500;
            color: var(--text-color-light);
        }

        .chat-box {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px; 
            background-color: var(--chat-bg-light); 
            /* Scrollbar uslubi (Chrome/Edge/Safari) */
            &::-webkit-scrollbar {
                width: 6px;
            }
            &::-webkit-scrollbar-thumb {
                background: var(--secondary-color);
                border-radius: 3px;
            }
            &::-webkit-scrollbar-track {
                background: #2a2a2a;
            }
        }
        
        .message-wrapper {
            display: flex;
            align-items: flex-end; 
            gap: 8px;
            animation: slideIn 0.3s ease-out; 
        }
        .user-wrapper {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .bot-wrapper {
            align-self: flex-start;
            flex-direction: row;
        }

        .bot-avatar {
            width: 30px; 
            height: 30px;
            min-width: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--text-color-dark); 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }
        
        .message {
            max-width: 80%; 
            padding: 14px 18px; 
            border-radius: 20px; 
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: var(--shadow-soft); 
            color: var(--text-color-light); 
            min-width: 0;
            flex-shrink: 1;
        }

        .user-message {
            color: var(--text-color-dark); 
            border-top-right-radius: 5px; 
            background: var(--chat-gradient);
        }

        .bot-message {
            background-color: var(--bubble-bot);
            color: var(--text-color-light); 
            border: 1px solid #4a4a4a; 
            border-top-left-radius: 5px; 
            font-family: 'Noto Serif', serif;
        }
        
        .disclaimer-message {
            background-color: #ff572240; /* Yorqinroq fon */
            border-left: 5px solid var(--accent-color);
            color: #ff5722; 
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-family: 'Poppins', sans-serif;
        }

        .bold-term {
            font-weight: 700;
            color: #00ffaa; /* Yashil-Teal aksenti */
            background-color: #383838; 
            border: 1px solid #555;
            padding: 2px 5px;
            border-radius: 5px;
            display: inline-block; /* O'zini tutishini yaxshilaydi */
            white-space: normal;
            font-size: 15px;
            line-height: 1.6;
        }

        .message-time {
            font-size: 10px;
            color: #888; 
            align-self: flex-end; 
            margin: 0 5px;
            white-space: nowrap;
            padding-bottom: 2px; 
        }
        
        @keyframes slideIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 1px;
            border-radius: 50%;
            background-color: var(--primary-color);
            opacity: 0.8;
            animation: 1s blink infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        #typingIndicator {
            background-color: #383838;
            border: 1px solid #555;
            color: var(--primary-color);
            border-radius: 25px;
            padding: 10px 18px;
            box-shadow: var(--shadow-soft);
        }

        /* Input va Tugma */
        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #333;
            background-color: #1a1a1a; 
            flex-shrink: 0;
            z-index: 10;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
        }
        .chat-input input[type="text"] {
            flex-grow: 1;
            padding: 12px 18px;
            border: 2px solid #555;
            border-radius: 25px;
            margin-right: 10px;
            font-size: 16px;
            background-color: #333; 
            color: var(--text-color-light);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .chat-input input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.5);
        }
        .chat-input button {
            color: var(--text-color-dark); 
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.6);
        }
        .chat-input button:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.02);
        }
        .chat-input button:disabled {
            background-color: #555;
            cursor: not-allowed;
            box-shadow: none;
            color: #888;
        }

        /* Quick Questions */
        .suggestion-container {
            width: 100%;
            padding: 10px;
            flex-shrink: 0;
            background-color: #1a1a1a;
            border-top: 1px solid #333;
            margin-top: auto;
            max-height: 40vh;
            overflow-y: auto;
            z-index: 5;
        }
        .suggestion-header {
             font-weight: 700;
             color: var(--primary-color);
             margin-bottom: 10px;
             font-size: 16px;
             text-align: center;
             border-bottom: 2px solid var(--accent-color);
             padding: 5px;
             background-color: #2a2a2a; 
             border-radius: 5px;
             position: sticky;
             top: 0;
             z-index: 6;
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 8px;
            padding-top: 5px;
        }
        .suggestion-button {
            background-color: #333333;
            color: var(--text-color-light);
            border: 1px solid #555;
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
            box-shadow: var(--shadow-soft);
            line-height: 1.3;
            white-space: normal;
            justify-self: stretch;
            align-self: stretch;
        }
        .suggestion-button:hover, .suggestion-button:focus {
            background-color: var(--primary-color);
            color: var(--text-color-dark); 
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.6);
            outline: none;
        }
        
        /* Splash Screen (YANGILANGAN QISM) */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000000, #1a1a1a);
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease-out, visibility 0.5s;
            color: var(--primary-color);
            font-size: 20px;
        }
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .splash-screen-title {
            font-family: 'Noto Serif', serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 188, 212, 0.7);
        }
        .splash-screen-subtitle {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 30px; 
            color: #ccc;
        }
        
        #startButton {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: var(--text-color-dark);
            background: linear-gradient(45deg, #00bcd4, #00ffaa); 
            box-shadow: 0 8px 20px rgba(var(--primary-color-rgb), 0.7);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #startButton:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(var(--primary-color-rgb), 0.9);
        }

        /* Kattaroq ekranlarda o'zgarish */
        @media (min-width: 551px) {
            body {
                padding: 20px;
                overflow: auto;
            }
            .chat-container {
                border-radius: 25px;
                box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6), 0 0 15px rgba(0, 0, 0, 0.1);
                height: auto;
                max-height: 95vh;
            }
            .message {
                max-width: 75%;
            }
        }
    </style>
</head>
<body>

<div class="splash-screen" id="splashScreen">
    <div class="splash-screen-title">
        ðŸ“š Ona tili va Adabiyot Ustozi
    </div>
    <div class="splash-screen-subtitle">
        6-sinf mavzulari bo'yicha sun'iy intellekt yordamchisi
    </div>
    <button id="startButton">Chatni Boshlash</button>
</div>

<div class="chat-container" id="chatContainer">
    <header class="chat-header" id="chatHeader">
        <span id="botName">AI Ona tili va Adabiyot Ustozi ðŸ“š</span>
        <div class="header-status">Faqat 6-sinf mavzulari bo'yicha yordam beradi</div>
    </header>

    <main class="chat-box" id="chatBox">
        <div id="typingIndicator" class="message-wrapper bot-wrapper" style="display: none;">
            <div class="bot-avatar">AI</div>
            <div class="message" style="background-color: #383838; border: 1px solid #555; color: var(--primary-color); border-radius: 25px; padding: 10px 18px;">
                <span id="typingText">AI yozmoqda</span>
                <span class="dot"></span> 
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        </div>
    </main>
    
    <div id="quickQuestionsContainer" class="suggestion-container" style="display: none;">
    </div>

    <footer class="chat-input">
        <input type="text" id="userInput" placeholder="Fe'l nisbati, Bobur ijodi yoki Maqol nima?..." onkeydown="if(event.key === 'Enter') sendInputFromButton()">
        <button id="sendButton" onclick="sendInputFromButton()">Yuborish</button>
    </footer>
</div>

<script>
    
    // ===========================================
    // Elementlarni olish
    // ===========================================
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const typingIndicator = document.getElementById('typingIndicator');
    const quickQuestionsContainer = document.getElementById('quickQuestionsContainer');
    const splashScreen = document.getElementById('splashScreen');
    const chatContainer = document.getElementById('chatContainer');
    const startButton = document.getElementById('startButton'); 

    const icon = "ðŸ“"; 
    const BOT_DELAY = 800; 
    const MAX_RANDOM_DELAY = 1200;

    // ===========================================
    // ASOSIY YUKLASH MANTIQI
    // ===========================================
    
    function appendDisclaimer() {
        const disclaimer = document.createElement('div');
        disclaimer.classList.add('disclaimer-message');
        disclaimer.innerHTML = 'âš ï¸ **Ogohlantirish:** Ushbu AI bot faqat OÊ»zbekiston Respublikasi 6-sinf **Ona tili va Adabiyot** darsliklari asosida tayyorlangan. Berilgan maÊ¼lumotlar shu doiradagi oÊ»quv materiallariga mos keladi.';
        chatBox.appendChild(disclaimer);
    }

    function startChat() {
        // 1. Splash screen'ni yashirish
        splashScreen.classList.add('hidden');
        
        // 2. Asosiy chat oynasini ko'rsatish
        setTimeout(() => {
             chatContainer.style.opacity = '1';
        }, 300); 

        // 3. Ogohlantirish xabarini chiqarish
        appendDisclaimer();

        // 4. Birinchi xabarni yuklash
        appendMessage(
            `Assalomu alaykum! ${icon} **AI Ona tili va Adabiyot Ustozi** ishga tushdi. Marhamat, 6-sinf mavzulari bo'yicha savollaringizni bering!`,
            'bot-message'
        );
        document.getElementById('sendButton').onclick = sendInputFromButton;
        displayQuickQuestions('main_menu'); 
        userInput.focus();
    }
    
    // Tugma bosilganda sayt ishga tushadi
    startButton.addEventListener('click', startChat);

    // ===========================================
    // QOLGAN FUNKSIYALAR
    // ===========================================
    
    function setInputDisabled(disabled) {
        userInput.disabled = disabled;
        sendButton.disabled = disabled;
        sendButton.textContent = disabled ? 'Kutish...' : 'Yuborish';
    }
    
    function appendMessage(text, className) {
        const time = new Date().toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });
        const isUser = className === 'user-message';

        const wrapper = document.createElement('div');
        wrapper.classList.add('message-wrapper', isUser ? 'user-wrapper' : 'bot-wrapper');

        if (!isUser) {
            const avatar = document.createElement('div');
            avatar.classList.add('bot-avatar');
            avatar.textContent = 'AI'; 
            wrapper.appendChild(avatar);
        }

        const messageElement = document.createElement('div');
        messageElement.classList.add('message', className);
        
        // Bold-term formatlash
        const formattedText = text.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
            return `<span class="bold-term">${p1.trim()}</span>`;
        });
        messageElement.innerHTML = formattedText.replace(/\n/g, '<br>');

        const timeElement = document.createElement('span');
        timeElement.classList.add('message-time');
        timeElement.textContent = time;

        wrapper.appendChild(messageElement);
        wrapper.appendChild(timeElement); 
        
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function processBotResponse(userText, nextQueriesKey = 'main_menu') {
        setInputDisabled(true);
        quickQuestionsContainer.style.display = 'none'; 
        typingIndicator.style.display = 'flex';
        chatBox.scrollTop = chatBox.scrollHeight;

        await new Promise(resolve => setTimeout(resolve, BOT_DELAY + Math.random() * MAX_RANDOM_DELAY)); 

        const botResponse = generateLangLitResponse(userText); 
        typingIndicator.style.display = 'none';
        
        appendMessage(botResponse, 'bot-message');
        
        displayQuickQuestions(nextQueriesKey); 
        
        setInputDisabled(false);
        userInput.focus();
    }

    function handleUserInput(queryData = {}) {
        let userText;
        let nextQueriesKey;

        if (typeof queryData === 'string' || !queryData.query) {
            userText = (queryData.query || userInput.value).trim();
            nextQueriesKey = 'main_menu'; 
            
            if (userText === "" || userInput.disabled) return;
            userInput.value = '';

        } else {
            userText = queryData.query.trim();
            nextQueriesKey = queryData.next_queries || 'main_menu';

            if (userText === "" || userInput.disabled) return;
            userInput.value = ''; 
        }

        appendMessage(userText, 'user-message');
        processBotResponse(userText, nextQueriesKey);
    }
    
    function sendInputFromButton() {
        handleUserInput({ query: userInput.value, next_queries: 'main_menu' });
    }


    // ===========================================
    // JAVOB MANTIQI (YANGILANDI)
    // ===========================================
    function generateLangLitResponse(userText) {
        const lowerCaseText = userText.toLowerCase().trim().replace(/['Ê¼`]/g, ''); 

        const responses = {
            "felning qaysi turlari 6-sinfda otiladi": `${icon} 6-sinfda asosan **Fe'lning mayllari, nisbatlari** va **Fe'lning asosiy shakllari** (harakat nomi, sifatdosh, ravishdosh) o'tiladi.`,
            "fel mayllari nima": `${icon} **Fe'l mayllari** harakatning voqelikka munosabatini ifodalaydi. Bular: \n1. **Xabar mayli** (Harakatning oddiy bajarilishini bildiradi: **bordi, keladi**). \n2. **Buyruq-istak mayli** (Harakatni bajarishga undash: **boring, kelsin**). \n3. **Shart-istak mayli** (Shart yoki istakni bildiradi: **borsa, kelsa edi**).`,
            "fel nisbatlari nima": `${icon} **Fe'l nisbatlari** harakatning bajaruvchi (ega)ga munosabatini ko'rsatadi. 6-sinfda o'tiladiganlari: \n* **Aniq nisbat:** Harakat egasi tomonidan bajariladi. \n* **O'zlik nisbat:** Harakat o'z ustida bajariladi (**-in, -il**). \n* **Majhul nisbat:** Harakatning egasi noma'lum (**-il, -n**). \n* **Birgalik nisbat:** Harakat birgalikda bajariladi (**-ish**).`,
            "harakat nomi nima": `${icon} **Harakat nomi** fe'lning ish-harakatini ot kabi nomlab ko'rsatadi. Qo'shimchalari: **-ish, -moq, -uv** (Masalan: **yozish, o'qimoq**).`,
            "sifatdosh nima": `${icon} **Sifatdosh** harakatni bajaruvchi yoki harakatga uchragan narsaning belgisini sifat kabi ifodalaydi. Asosiy qo'shimchalari: **-gan, -ayotgan, -adigan, -r** (Masalan: **yozgan** bola, **o'qiladigan** kitob).`,
            "ravishdosh nima": `${icon} **Ravishdosh** asosiy fe'lga bog'lanib, uning bajarilish tarzi, payti, sababini bildiradi. Qo'shimchalari: **-b, -ib, -a, -y, -gach, -gani** (Masalan: **yugurib** keldi, **o'qiganimdan so'ng**).`,
            
            "felning otgan zamoni": `${icon} **Fe'lning o'tgan zamoni** harakatning gapirilish paytidan avval sodir bo'lganini bildiradi. Asosiy turlari: \n* **Guvohli o'tgan zamon** (-di): Harakatni ko'rgan holda aytish (**keldi**). \n* **Guvohsiz o'tgan zamon** (-gan): Harakatni bilvosita aytish (**kelgan**).`,
            "felning hozirgi zamoni": `${icon} **Fe'lning hozirgi zamoni** harakatning gapirilish paytida davom etayotganini bildiradi. Qo'shimchalari: \n* **-moqda** (Men **o'qimoqdaman**). \n* **-yap** (Ular **kelishyapti**). \n* **-a(y)otir** (U **yozayotir**).`,
            "felning kelasi zamoni": `${icon} **Fe'lning kelasi zamoni** harakatning nutq so'zlanayotgan paytdan keyin sodir bo'lishini bildiradi. Qo'shimchalari: **-adi, -r, -moqchi** (Masalan: **yozadi, aytar, bormoqchiman**).`,
            
            "otning kelishiklari nima": `${icon} **Otning kelishiklari** Otlarning boshqa so'zlarga bo'lgan munosabatini bildiradi. O'zbek tilida **6 ta kelishik** bor.`,
            "boglovchi nima": `${icon} **Bog'lovchi** so'zlarni yoki gaplarni bir-biriga bog'lash uchun ishlatiladigan yordamchi so'z turkumidir. Turlari: **Teng bog'lovchilar** (**va, ammo**) va **Ergashtiruvchi bog'lovchilar** (**chunki, agar**).`,
            "yuklamalar turlari nima": `${icon} **Yuklamalar** (mi, u/yu, faqat, ham, na, -ku) gapga qo'shimcha ma'no (so'roq, ta'kid, gumon) beruvchi yordamchi so'z turkumidir.`,
            
            "bobur hayoti va ijodi": `${icon} **Zahiriddin Muhammad Bobur** (1483-1530) â€” buyuk shoh, shoir va olim. Asosiysi: **"Boburnoma"** (tarixiy-memuar asar). U temuriy shahzodalardan bo'lib, Hindistonda Boburiylar davlatiga asos solgan.`,
            "g'afur g'ulom asarlari": `${icon} **G'afur G'ulom** (1903-1966) â€” Xalq shoiri. 6-sinfda uning **"Shum bola"** qissasi, **"Vaqt"** kabi she'rlari o'tiladi. U o'zbek adabiyotining eng yirik namoyandalaridan biri.`,
            "shum bola bosh qahramoni kim": `${icon} G'afur G'ulomning **"Shum bola"** qissasining bosh qahramoni â€” **Qoravoy**dir. Asar o'zbek xalqining o'tmishdagi turmush tarzini yorqin aks ettirgan.`,
            "furqat va muqimiy ijodi": `${icon} **Furqat va Muqimiy** XIX asr oxiri, XX asr boshidagi ma'rifatparvar shoirlar. Ijodlarida ijtimoiy haqsizlik, ma'rifatga chaqiriq va adolat mavzulari yoritilgan.`,
            
            "ertak nima": `${icon} **Ertak** â€” to'qima syujetga asoslangan, sehrli yoki hayotiy voqealarni hikoya qiluvchi xalq og'zaki ijodi janri. Ertaklar asosan **sehrli, hayvonlar haqidagi** va **maishiy-hayotiy** turlarga bo'linadi.`,
            "maqol va matal farqi": `${icon} **Maqol** tugallangan fikrni, hikmatli xulosani beradi (masalan: **"Bilim olar yoshdan"**). **Matal** esa o'xshatish, taqqoslash ma'nosini bildiradi, mustaqil hukm yoki fikrni yakunlamaydi (masalan: **"Qizil olma kabi"**).`,
            
            "default": `${icon} Berilgan savol 6-sinf ona tili va adabiyot mavzulariga mos kelmadi. Iltimos, **Fe'lning zamonlari, Bog'lovchilar, Boburning "Boburnoma"si** kabi mavzular doirasida so'rov yuboring.`
        };
        
        for (const [keyword, response] of Object.entries(responses)) {
            if (lowerCaseText.includes(keyword)) {
                return response;
            }
        }
        
        return responses["default"];
    }
    
    // ===========================================
    // TEZKOR TUGMALAR STRUKTURASI
    // ===========================================
    
    const QUICK_QUERY_TREE = {
        
        "main_menu": [
            { text: "Tilshunoslik (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6" },
            { text: "Adabiyot (Mualliflar va Asarlar)", query: "6-sinf adabiyoti", next_queries: "adabiyot_6" },
            { text: "Xalq og'zaki ijodi", query: "Xalq og'zaki ijodi nima?", next_queries: "xalq_ijodi_6" },
            { text: "Tasodifiy savollar", query: "Tasodifiy savollarni ko'rsat", next_queries: "shuffle_all", is_navigation: true }
        ],
        "tilshunoslik_6": [
            { text: "Fe'lning asosiy mavzulari", query: "Fe'lning qaysi turlari 6-sinfda o'tiladi?", next_queries: "fel_6" },
            { text: "Fe'lning zamonlari", query: "Fe'l zamonlari qanday?" , next_queries: "fel_zamonlari_6" },
            { text: "Fe'lning shakllari (Harakat nomi, Sifatdosh, Ravishdosh)", query: "Fe'lning shakllari nima?", next_queries: "fel_shakllari_6" },
            { text: "Yordamchi so'zlar (Bog'lovchi, Yuklama)", query: "Ko'makchi so'zlar nima?", next_queries: "yordamchi_sozlar_6" },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "fel_6": [
            { text: "Fe'l mayllari", query: "Fe'l mayllari nima?" },
            { text: "Fe'l nisbatlari", query: "Fe'l nisbatlari nima?" },
            { text: "Fe'l turkumi umumiy", query: "Fe'l turkumi qanday so'z turkumi" },
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "fel_zamonlari_6": [
            { text: "O'tgan zamon", query: "Fe'lning otgan zamoni" }, 
            { text: "Hozirgi zamon", query: "Fe'lning hozirgi zamoni" }, 
            { text: "Kelasi zamon", query: "Fe'lning kelasi zamoni" }, 
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "fel_shakllari_6": [
            { text: "Harakat nomi", query: "Harakat nomi nima?" },
            { text: "Sifatdosh nima?", query: "Sifatdosh nima?" },
            { text: "Ravishdosh nima?", query: "Ravishdosh nima?" },
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "yordamchi_sozlar_6": [
            { text: "Ko'makchilar", query: "Ko'makchi so'zlar nima?" },
            { text: "Bog'lovchilar", query: "Bog'lovchi nima?" },
            { text: "Yuklamalar turlari", query: "Yuklamalar turlari nima?" }, 
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "adabiyot_6": [
            { text: "Zahiriddin Muhammad Bobur", query: "Bobur hayoti va ijodi" },
            { text: "G'afur G'ulom asarlari", query: "G'afur G'ulom asarlari" },
            { text: "Shum bola bosh qahramoni", query: "Shum bola bosh qahramoni kim" }, 
            { text: "Furqat va Muqimiy ijodi", query: "Furqat va Muqimiy ijodi" },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "xalq_ijodi_6": [
            { text: "Ertak turlari", query: "Ertak nima?" },
            { text: "Maqol nima?", query: "Maqol nima" },
            { text: "Doston nima?", query: "Doston nima" }, 
            { text: "Maqol va matal farqi", query: "Maqol va matal farqi" }, 
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "shuffle_all": [
             // Navigatsiya tugmalari doim yuqorida turishi uchun
            { text: "ðŸ”„ Boshqa tasodifiy savollar", query: "Tasodifiy savollarni yangilash", next_queries: "shuffle_all", is_navigation: true },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true }
        ]
    };
    
    // Barcha so'rovlarni yig'ish (Shuffle uchun)
    const ALL_QUERY_LIST = Object.values(QUICK_QUERY_TREE)
        .flat()
        .filter(q => !q.is_navigation) 
        .map(q => ({ text: q.text, query: q.query, next_queries: q.next_queries || 'main_menu' }));


    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[i], array[j]]; 
        }
    }

    function displayQuickQuestions(key = 'main_menu') {
        let headerText = "6-sinf mavzularini tanlang:";
        let buttonsToDisplay = [];
        let navigationButtons = QUICK_QUERY_TREE[key] ? QUICK_QUERY_TREE[key].filter(btn => btn.is_navigation) : [];
        let contentButtons = QUICK_QUERY_TREE[key] ? QUICK_QUERY_TREE[key].filter(btn => !btn.is_navigation) : [];
        
        if (key === 'shuffle_all') {
            headerText = "ðŸ“š 6-sinf bo'yicha tasodifiy mavzular (15 ta):";
            shuffleArray(ALL_QUERY_LIST);
            const randomQueries = ALL_QUERY_LIST.slice(0, 15);
            
            // Navigatsiya tugmalarini alohida qo'shish
            buttonsToDisplay = [
                ...navigationButtons, 
                ...randomQueries
            ];
            
        } else {
            buttonsToDisplay = QUICK_QUERY_TREE[key] || QUICK_QUERY_TREE['main_menu'];
            // Navigatsiya tugmalari oxirida turishi uchun
            navigationButtons = buttonsToDisplay.filter(btn => btn.is_navigation);
            contentButtons = buttonsToDisplay.filter(btn => !btn.is_navigation);
            buttonsToDisplay = [...contentButtons, ...navigationButtons];
        }

        let html = `<div class="suggestion-header">${headerText}</div>`;
        html += '<div class="suggestion-grid">';
        
        buttonsToDisplay.forEach(btn => {
            const nextQueriesAttr = btn.next_queries ? `data-next-queries="${btn.next_queries}"` : 'data-next-queries="main_menu"';
            const isNavigationAttr = btn.is_navigation ? 'data-is-navigation="true"' : '';
            const navClass = btn.is_navigation ? ' style="order: 99; background-color: #555; border-color: #777;"' : ''; // Navigatsiyani pastga tushirish

            html += `<button class="suggestion-button" 
                                data-query="${btn.query}" 
                                ${nextQueriesAttr} 
                                ${isNavigationAttr}
                                ${navClass}
                            >
                                ${btn.text}
                            </button>`;
        });
        
        html += '</div>';

        quickQuestionsContainer.innerHTML = html;
        quickQuestionsContainer.style.display = 'block';

        quickQuestionsContainer.querySelectorAll('.suggestion-button').forEach(button => {
            button.onclick = () => {
                const query = button.getAttribute('data-query');
                const next_queries = button.getAttribute('data-next-queries');
                const is_navigation = button.getAttribute('data-is-navigation') === 'true';

                if (is_navigation) {
                    displayQuickQuestions(next_queries);
                    return;
                }

                handleUserInput({ query: query, next_queries: next_queries });
            };
        });
        quickQuestionsContainer.scrollTop = 0; 
    }
    
    // ===========================================
    // INIT (BOSHLANISH)
    // ===========================================
    window.onload = () => {
        // Hozircha bu yer bo'sh qoladi, chunki `startButton` bilan boshlanadi.
    };
</script>

</body>
</html>
