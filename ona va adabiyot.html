<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ona tili va Adabiyot Ustozi| Boshlash Tugmasi</title>
    <style>
        /* ================================================= */
        /* TUZATILGAN VA BARQAROR DARK MODE CSS QISMI */
        /* ================================================= */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Serif:wght@400;700&display=swap');
        
        :root {
            --primary-color: #00bcd4; /* Asosiy Yorqin Rang (Teal) */
            --primary-color-rgb: 0, 188, 212;
            --secondary-color: #0097a7; /* To'qroq Teal */
            --bg-color: #1a1a1a; /* Umumiy To'q Fon */
            --chat-bg-light: #242424; /* Chat Box orqa foni */
            --bubble-user: #00bcd4; /* User xabari */
            --bubble-bot: #333333; /* Bot xabari */
            --text-color-light: #f0f0f0; /* Yorqin matn */
            --text-color-dark: #121212; /* To'q matn */
            --button-border: #444;
            --accent-color: #ff5722; /* Kichik aksent */
            --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.5); 
            --chat-gradient: linear-gradient(135deg, var(--bubble-user), var(--secondary-color));
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color); 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: hidden;
            box-sizing: border-box;
            color: var(--text-color-light); 
        }

        .chat-container {
            width: 100%;
            max-width: 550px;
            background-color: var(--chat-bg-light);
            border-radius: 20px; 
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6); 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
            border: 1px solid #3a3a3a; 
            /* Dastlab yashiriladi, splash screen ketgach ko'rinadi */
            opacity: 0; 
            transition: opacity 0.5s;
        }

        .chat-header {
            background-color: #000000; 
            color: var(--primary-color);
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
            border-bottom: 3px solid var(--secondary-color);
        }
        .header-status {
            font-size: 13px;
            opacity: 0.8;
            font-weight: 500;
            color: var(--text-color-light);
        }

        .chat-box {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px; 
            background-color: var(--chat-bg-light); 
        }
        
        .message-wrapper {
            display: flex;
            align-items: flex-end; 
            gap: 8px;
            animation: slideIn 0.3s ease-out; 
        }
        .user-wrapper {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .bot-wrapper {
            align-self: flex-start;
            flex-direction: row;
        }

        .bot-avatar {
            width: 30px; 
            height: 30px;
            min-width: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--text-color-dark); 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }
        
        .message {
            max-width: 80%; 
            padding: 14px 18px; 
            border-radius: 20px; 
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: var(--shadow-soft); 
            color: var(--text-color-light); 
            min-width: 0;
            flex-shrink: 1;
        }

        .user-message {
            color: var(--text-color-dark); 
            border-top-right-radius: 5px; 
            background: var(--chat-gradient);
        }

        .bot-message {
            background-color: var(--bubble-bot);
            color: var(--text-color-light); 
            border: 1px solid #4a4a4a; 
            border-top-left-radius: 5px; 
            font-family: 'Noto Serif', serif;
        }

        .bold-term {
            font-weight: 700;
            color: var(--primary-color); 
            background-color: #383838; 
            border: 1px solid #555;
            padding: 2px 5px;
            border-radius: 5px;
            display: inline;
            white-space: normal;
            font-size: 15px;
        }

        .message-time {
            font-size: 10px;
            color: #888; 
            align-self: flex-end; 
            margin: 0 5px;
            white-space: nowrap;
            padding-bottom: 2px; 
        }
        
        @keyframes slideIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 1px;
            border-radius: 50%;
            background-color: var(--primary-color);
            opacity: 0.8;
            animation: 1s blink infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        #typingIndicator {
            background-color: #383838;
            border: 1px solid #555;
            color: var(--primary-color);
            border-radius: 25px;
            padding: 10px 18px;
            box-shadow: var(--shadow-soft);
        }

        /* Input va Tugma */
        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #333;
            background-color: #1e1e1e; 
            flex-shrink: 0;
            z-index: 10;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
        }
        .chat-input input[type="text"] {
            flex-grow: 1;
            padding: 12px 18px;
            border: 2px solid #555;
            border-radius: 25px;
            margin-right: 10px;
            font-size: 16px;
            background-color: #333; 
            color: var(--text-color-light);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .chat-input input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.5);
        }
        .chat-input button {
            color: var(--text-color-dark); 
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.6);
        }
        .chat-input button:hover:not(:disabled) {
            opacity: 0.9;
            transform: scale(1.02);
        }
        .chat-input button:disabled {
            background-color: #555;
            cursor: not-allowed;
            box-shadow: none;
            color: #888;
        }

        /* Quick Questions */
        .suggestion-container {
            width: 100%;
            padding: 10px;
            flex-shrink: 0;
            background-color: #1e1e1e;
            border-top: 1px solid #333;
            margin-top: auto;
            max-height: 40vh;
            overflow-y: auto;
            z-index: 5;
        }
        .suggestion-header {
             font-weight: 700;
             color: var(--primary-color);
             margin-bottom: 10px;
             font-size: 16px;
             text-align: center;
             border-bottom: 2px solid var(--accent-color);
             padding: 5px;
             background-color: #2a2a2a; 
             border-radius: 5px;
             position: sticky;
             top: 0;
             z-index: 6;
             box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 8px;
            padding-top: 5px;
        }
        .suggestion-button {
            background-color: #333333;
            color: var(--text-color-light);
            border: 1px solid #555;
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: center;
            box-shadow: var(--shadow-soft);
            line-height: 1.3;
            white-space: normal;
            justify-self: stretch;
            align-self: stretch;
        }
        .suggestion-button:hover, .suggestion-button:focus {
            background-color: var(--primary-color);
            color: var(--text-color-dark); 
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.6);
            outline: none;
        }
        
        /* Splash Screen (YANGI QISM) */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000000, #1a1a1a);
            display: flex;
            flex-direction: column; /* Matn va tugmani ustma-ust qo'yish uchun */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease-out, visibility 0.5s;
            color: var(--primary-color);
            font-size: 20px;
        }
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .spinner-3d {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 30px; /* Tugmadan ajratish */
            text-align: center;
            padding: 20px;
            animation: none; /* Animatsiyani o'chirib qo'yamiz */
        }
        
        #startButton {
            padding: 15px 30px;
            font-size: 20px;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: var(--text-color-dark);
            background: linear-gradient(45deg, #00bcd4, #00ffaa); /* Yorqinroq effekt */
            box-shadow: 0 8px 20px rgba(var(--primary-color-rgb), 0.7);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #startButton:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(var(--primary-color-rgb), 0.9);
        }

        /* Kattaroq ekranlarda o'zgarish (SAQLANGAN) */
        @media (min-width: 551px) {
            body {
                padding: 20px;
                overflow: auto;
            }
            .chat-container {
                border-radius: 25px;
                box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6), 0 0 15px rgba(0, 0, 0, 0.1);
                height: auto;
                max-height: 95vh;
            }
            .message {
                max-width: 75%;
            }
        }
    </style>
</head>
<body>

<div class="splash-screen" id="splashScreen">
    <div class="spinner-3d">
        AI Ona tili va Adabiyot Ustozi.
    </div>
    <button id="startButton">Boshlash</button>
</div>

<div class="chat-container" id="chatContainer">
    <header class="chat-header" id="chatHeader">
        <span id="botName">AI Ona tili va Adabiyot Ustozi ðŸ“– (6-sinf)</span>
        <div class="header-status">Faqat 6-sinf mavzulari bo'yicha yordam beradi</div>
    </header>

    <main class="chat-box" id="chatBox">
        <div id="typingIndicator">
            <span id="typingText">AI yozmoqda</span>
            <span class="dot"></span> 
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </main>
    
    <div id="quickQuestionsContainer" class="suggestion-container" style="display: none;">
    </div>

    <footer class="chat-input">
        <input type="text" id="userInput" placeholder="Fe'l, Bog'lovchi yoki Adiblar bo'yicha savolingizni yozing..." onkeydown="if(event.key === 'Enter') sendInputFromButton()">
        <button id="sendButton" onclick="sendInputFromButton()">Yuborish</button>
    </footer>
</div>

<script>
    
    // ===========================================
    // Elementlarni olish (SAQLANGAN)
    // ===========================================
    const chatBox = document.getElementById('chatBox');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const typingIndicator = document.getElementById('typingIndicator');
    const quickQuestionsContainer = document.getElementById('quickQuestionsContainer');
    const splashScreen = document.getElementById('splashScreen');
    const chatContainer = document.getElementById('chatContainer');
    const startButton = document.getElementById('startButton'); 

    const icon = "ðŸ“š"; 
    const BOT_DELAY = 800; 
    const MAX_RANDOM_DELAY = 800;

    // ===========================================
    // ASOSIY YUKLASH MANTIQI (O'ZGARTIRILDI)
    // ===========================================
    
    function startChat() {
        // 1. Splash screen'ni yashirish
        splashScreen.classList.add('hidden');
        
        // 2. Asosiy chat oynasini ko'rsatish
        setTimeout(() => {
             chatContainer.style.opacity = '1';
        }, 300); // Yashirish animatsiyasidan so'ng

        // 3. Birinchi xabarni yuklash
        appendMessage(
            `Assalomu alaykum! **AI Ona tili va Adabiyot Boti** ishga tushdi. Marhamat, 6-sinf mavzulari bo'yicha savollaringizni bering!`,
            'bot-message'
        );
        document.getElementById('sendButton').onclick = sendInputFromButton;
        displayQuickQuestions('main_menu'); 
        userInput.focus();
    }
    
    // Tugma bosilganda sayt ishga tushadi
    startButton.addEventListener('click', startChat);

    // ===========================================
    // QOLGAN FUNKSIYALAR (SAQLANGAN)
    // ===========================================
    
    function setInputDisabled(disabled) {
        userInput.disabled = disabled;
        sendButton.disabled = disabled;
        sendButton.textContent = disabled ? 'Kutish...' : 'Yuborish';
    }
    
    function appendMessage(text, className) {
        const time = new Date().toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });
        const isUser = className === 'user-message';

        const wrapper = document.createElement('div');
        wrapper.classList.add('message-wrapper', isUser ? 'user-wrapper' : 'bot-wrapper');

        if (!isUser) {
            const avatar = document.createElement('div');
            avatar.classList.add('bot-avatar');
            avatar.textContent = 'AI'; 
            wrapper.appendChild(avatar);
        }

        const messageElement = document.createElement('div');
        messageElement.classList.add('message', className);
        
        const formattedText = text.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
            return `<span class="bold-term">${p1.trim()}</span>`;
        });
        messageElement.innerHTML = formattedText.replace(/\n/g, '<br>');

        const timeElement = document.createElement('span');
        timeElement.classList.add('message-time');
        timeElement.textContent = time;

        if (isUser) {
            wrapper.appendChild(messageElement);
            wrapper.appendChild(timeElement); 
        } else {
            wrapper.appendChild(messageElement);
            wrapper.appendChild(timeElement);
        }
        
        chatBox.appendChild(wrapper);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function processBotResponse(userText, nextQueriesKey = 'main_menu') {
        setInputDisabled(true);
        quickQuestionsContainer.style.display = 'none'; 
        typingIndicator.style.display = 'flex';
        chatBox.scrollTop = chatBox.scrollHeight;

        await new Promise(resolve => setTimeout(resolve, BOT_DELAY + Math.random() * MAX_RANDOM_DELAY)); 

        const botResponse = generateLangLitResponse(userText); 
        typingIndicator.style.display = 'none';
        
        appendMessage(botResponse, 'bot-message');
        
        displayQuickQuestions(nextQueriesKey); 
        
        setInputDisabled(false);
        userInput.focus();
    }

    function handleUserInput(queryData = {}) {
        let userText;
        let nextQueriesKey;

        if (typeof queryData === 'string' || !queryData.query) {
            userText = (queryData.query || userInput.value).trim();
            nextQueriesKey = 'main_menu'; 
            
            if (userText === "" || userInput.disabled) return;
            userInput.value = '';

        } else {
            userText = queryData.query.trim();
            nextQueriesKey = queryData.next_queries || 'main_menu';

            if (userText === "" || userInput.disabled) return;
            userInput.value = ''; 
        }

        appendMessage(userText, 'user-message');
        processBotResponse(userText, nextQueriesKey);
    }
    
    function sendInputFromButton() {
        handleUserInput({ query: userInput.value, next_queries: 'main_menu' });
    }


    // ===========================================
    // JAVOB MANTIQI (SAQLANGAN)
    // ===========================================
    function generateLangLitResponse(userText) {
        const lowerCaseText = userText.toLowerCase().trim().replace(/['Ê¼`]/g, ''); 

        const responses = {
            "felning qaysi turlari 6-sinfda otiladi": `${icon} 6-sinfda asosan **Fe'lning mayllari, nisbatlari** va **Fe'lning asosiy shakllari** (harakat nomi, sifatdosh, ravishdosh) o'tiladi.`,
            "fel mayllari nima": `${icon} **Fe'l mayllari** (Xabar, Buyruq-istak, Shart-istak) harakatning voqelikka munosabatini bildiradi. Masalan: **o'qiydi** (xabar), **o'qisin** (buyruq).`,
            "fel nisbatlari nima": `${icon} **Fe'l nisbatlari** (Aniq, O'zlik, Majhul, Birgalik) harakatning bajaruvchi (ega)ga munosabatini ko'rsatadi.`,
            "harakat nomi nima": `${icon} **Harakat nomi** fe'lning ish-harakatini ot kabi nomlab ko'rsatadi. Qo'shimchalari: **-ish, -moq, -uv** (Masalan: **yozish, o'qimoq**).`,
            "sifatdosh nima": `${icon} **Sifatdosh** harakatni bajaruvchi yoki harakatga uchragan narsaning belgisini sifat kabi ifodalaydi. (Masalan: **kelgan** odam, **o'qiladigan** kitob).`,
            "ravishdosh nima": `${icon} **Ravishdosh** asosiy fe'lga bog'lanib, uning bajarilish tarzi, payti, sababini bildiradi. (Masalan: **yugurib** keldi, **o'qiganimdan so'ng**).`,
            "felning otgan zamoni": `${icon} **Fe'lning o'tgan zamoni** harakatning gapirilish paytidan avval sodir bo'lganini bildiradi. Asosan **-di, -gan, -ib edi** kabi shakllarda ifodalanadi.`,
            "felning hozirgi zamoni": `${icon} **Fe'lning hozirgi zamoni** harakatning gapirilish paytida davom etayotganini bildiradi. **-moqda, -yap, -a(y)otir** qo'shimchalari orqali yasaladi.`,
            "otning kelishiklari nima": `${icon} **Otning kelishiklari** Otlarning boshqa so'zlarga bo'lgan munosabatini bildiradi. O'zbek tilida **6 ta kelishik** bor (Bosh, Qaratqich, Tushum, Jo'nalish, O'rin-payt, Chiqish).`,
            "kelishiklar vazifasi": `${icon} **Kelishiklar** otlarni gapda ega, to'ldiruvchi, aniqlovchi yoki hol vazifasida kelishini ta'minlaydi.`,
            "ko'makchi so'zlar nima": `${icon} **Ko'makchilar** (uchun, bilan, kabi, to'g'risida) mustaqil so'zlarga qo'shilib, ularning boshqa so'zlar bilan bog'lanishini ta'minlaydi.`,
            "boglovchi nima": `${icon} **Bog'lovchi** so'zlarni yoki gaplarni bir-biriga bog'lash uchun ishlatiladi. (Masalan: **va, ham, ammo**).`,
            "yuklamalar turlari nima": `${icon} **Yuklamalar** (mi, u/yu, faqat, ham, na) gapga qo'shimcha ma'no (so'roq, ta'kid, gumon) beruvchi yordamchi so'z turkumidir.`,
            "bobur hayoti va ijodi": `${icon} **Zahiriddin Muhammad Bobur** (1483-1530) â€” buyuk shoh, shoir va olim. Asosiysi: **"Boburnoma"** (tarixiy-memuar asar).`,
            "g'afur g'ulom asarlari": `${icon} **G'afur G'ulom** (1903-1966) â€” Xalq shoiri. 6-sinfda uning **"Shum bola"** qissasi, **"Vaqt"** kabi she'rlari o'tiladi.`,
            "shum bola bosh qahramoni kim": `${icon} G'afur G'ulomning **"Shum bola"** qissasining bosh qahramoni â€” **Qoravoy**dir. Uning sarguzashtlari orqali yozuvchi davrni ko'rsatadi.`,
            "furqat va muqimiy ijodi": `${icon} **Furqat va Muqimiy** XIX asr oxiri, XX asr boshidagi ma'rifatparvar shoirlar. Ijodlarida ijtimoiy haqsizlik va adolat mavzulari yoritilgan.`,
            "navoiy bobur aloqasi": `${icon} **Alisher Navoiy** (XV asr) Boburning bobosi **Amir Temur** davrida yashagan. Bobur o'zining she'riyat va adabiyotga bo'lgan muhabbatida Navoiy ijodini yuksak qadrlagan.`,
            "ertak nima": `${icon} **Ertak** â€” to'qima syujetga asoslangan, sehrli yoki hayotiy voqealarni hikoya qiluvchi xalq og'zaki ijodi janri.`,
            "maqol nima": `${icon} **Maqol** â€” qisqa, obrazli, chuqur mazmunli, asosan hayotiy xulosa va ta'limotni ifodalovchi turg'un gap. (Masalan: "Mehnat â€“ rohat").`,
            "doston nima": `${icon} **Doston** â€” Qahramonlik, tarixiy yoki sevgi mavzusidagi she'riy shaklda yozilgan katta hajmli epik asar. Masalan: **"Alpomish"**.`,
            "maqol va matal farqi": `${icon} **Maqol** tugallangan fikrni beradi (**"Bilim olar yoshdan"**), **Matal** esa o'xshatish, taqqoslash ma'nosini bildiradi, ammo mustaqil fikrni yakunlamaydi (**"Qizil olma kabi"**).`,
            "default": `${icon} Berilgan savol 6-sinf ona tili va adabiyot mavzulariga mos kelmadi. Iltimos, **Fe'l, Bog'lovchi, Bobur, G'afur G'ulom, Ertak** kabi mavzular doirasida so'rov yuboring.`,
        };
        
        for (const [keyword, response] of Object.entries(responses)) {
            if (lowerCaseText.includes(keyword)) {
                return response;
            }
        }
        
        return responses["default"];
    }
    
    // ===========================================
    // TEZKOR TUGMALAR STRUKTURASI (SAQLANGAN)
    // ===========================================
    
    const QUICK_QUERY_TREE = {
        
        "main_menu": [
            { text: "Tilshunoslik (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6" },
            { text: "Adabiyot (Mualliflar va Asarlar)", query: "6-sinf adabiyoti", next_queries: "adabiyot_6" },
            { text: "Xalq og'zaki ijodi", query: "Xalq og'zaki ijodi nima?", next_queries: "xalq_ijodi_6" },
            { text: "Tasodifiy savollar", query: "Tasodifiy savollarni ko'rsat", next_queries: "shuffle_all", is_navigation: true }
        ],
        "tilshunoslik_6": [
            { text: "Fe'l bo'yicha savollar", query: "Fe'lning qaysi turlari 6-sinfda o'tiladi?", next_queries: "fel_6" },
            { text: "Ot (Takrorlash va Kelishiklar)", query: "Ot kelishiklari haqida", next_queries: "ot_6" }, 
            { text: "Fe'lning shakllari", query: "Fe'lning shakllari nima?", next_queries: "fel_shakllari_6" },
            { text: "Yordamchi so'zlar", query: "Ko'makchi so'zlar nima?", next_queries: "yordamchi_sozlar_6" },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "ot_6": [
            { text: "Otning kelishiklari", query: "Otning kelishiklari nima" },
            { text: "Kelishiklar vazifasi", query: "Kelishiklar vazifasi" },
            { text: "Ot turkumi umumiy", query: "Ot turkumi qanday so'z turkumi" },
            { text: "â¬…ï¸ Orqaga (Tilshunoslik)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "fel_6": [
            { text: "Fe'l mayllari", query: "Fe'l mayllari nima?" },
            { text: "Fe'l nisbatlari", query: "Fe'l nisbatlari nima?" },
            { text: "Fe'lning o'tgan zamoni", query: "Fe'lning otgan zamoni" }, 
            { text: "Fe'lning hozirgi zamoni", query: "Fe'lning hozirgi zamoni" }, 
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "fel_shakllari_6": [
            { text: "Harakat nomi", query: "Harakat nomi nima?" },
            { text: "Sifatdosh nima?", query: "Sifatdosh nima?" },
            { text: "Ravishdosh nima?", query: "Ravishdosh nima?" },
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "yordamchi_sozlar_6": [
            { text: "Ko'makchilar", query: "Ko'makchi so'zlar nima?" },
            { text: "Bog'lovchilar", query: "Bog'lovchi nima?" },
            { text: "Yuklamalar turlari", query: "Yuklamalar turlari nima?" }, 
            { text: "â¬…ï¸ Orqaga (Grammatika)", query: "6-sinf grammatikasi", next_queries: "tilshunoslik_6", is_navigation: true },
        ],
        "adabiyot_6": [
            { text: "Zahiriddin Muhammad Bobur", query: "Bobur hayoti va ijodi" },
            { text: "G'afur G'ulom asarlari", query: "G'afur G'ulom asarlari" },
            { text: "Shum bola bosh qahramoni", query: "Shum bola bosh qahramoni kim" }, 
            { text: "Navoiy va Bobur aloqasi", query: "Navoiy Bobur aloqasi" }, 
            { text: "Furqat va Muqimiy ijodi", query: "Furqat va Muqimiy ijodi" },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "xalq_ijodi_6": [
            { text: "Ertak turlari", query: "Ertak nima?" },
            { text: "Doston nima?", query: "Doston nima" }, 
            { text: "Maqol va matal farqi", query: "Maqol va matal farqi" }, 
            { text: "Topishmoq va Afsona", query: "Afsona nima?" },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ],
        "shuffle_all": [
            { text: "ðŸ”„ Boshqa tasodifiy savollar", query: "Tasodifiy savollarni yangilash", next_queries: "shuffle_all", is_navigation: true },
            { text: "â¬…ï¸ Bosh menyuga qaytish", query: "6-sinf mavzularini ko'rsat", next_queries: "main_menu", is_navigation: true },
        ]
    };
    
    // Barcha so'rovlarni yig'ish
    const ALL_QUERY_LIST = Object.values(QUICK_QUERY_TREE)
        .flat()
        .filter(q => !q.is_navigation) 
        .map(q => ({ text: q.text, query: q.query, next_queries: q.next_queries || 'main_menu' }));


    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[i], array[j]]; 
        }
    }

    function displayQuickQuestions(key = 'main_menu') {
        let headerText = "6-sinf mavzularini tanlang:";
        let buttonsToDisplay = [];
        
        if (key === 'shuffle_all') {
            headerText = "ðŸ“š 6-sinf bo'yicha tasodifiy mavzular (15 ta):";
            shuffleArray(ALL_QUERY_LIST);
            const randomQueries = ALL_QUERY_LIST.slice(0, 15);
            
            buttonsToDisplay = [
                ...randomQueries,
                ...QUICK_QUERY_TREE[key]
            ];
            
        } else {
            buttonsToDisplay = QUICK_QUERY_TREE[key] || QUICK_QUERY_TREE['main_menu'];
        }

        let html = `<div class="suggestion-header">${headerText}</div>`;
        html += '<div class="suggestion-grid">';
        
        buttonsToDisplay.forEach(btn => {
            const nextQueriesAttr = btn.next_queries ? `data-next-queries="${btn.next_queries}"` : 'data-next-queries="main_menu"';
            const isNavigationAttr = btn.is_navigation ? 'data-is-navigation="true"' : '';

            html += `<button class="suggestion-button" 
                        data-query="${btn.query}" 
                        ${nextQueriesAttr} 
                        ${isNavigationAttr}
                    >
                        ${btn.text}
                    </button>`;
        });
        
        html += '</div>';

        quickQuestionsContainer.innerHTML = html;
        quickQuestionsContainer.style.display = 'block';

        quickQuestionsContainer.querySelectorAll('.suggestion-button').forEach(button => {
            button.onclick = () => {
                const query = button.getAttribute('data-query');
                const next_queries = button.getAttribute('data-next-queries');
                const is_navigation = button.getAttribute('data-is-navigation') === 'true';

                if (is_navigation) {
                    displayQuickQuestions(next_queries);
                    return;
                }

                handleUserInput({ query: query, next_queries: next_queries });
            };
        });
        quickQuestionsContainer.scrollTop = 0; 
    }
    
    // ===========================================
    // INIT (BOSHLANISH) - Endi faqat tugmaga ulanadi
    // ===========================================
    window.onload = () => {
        // Chat oynasi avval yashirin bo'ladi, tugma bosilgach ko'rinadi.
    };
</script>

</body>
</html>
