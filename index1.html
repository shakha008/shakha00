<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title id="pageTitle">üåç Butun Dunyo Bayroqlari ‚Äî Super Mega Versiya</title>
    <style>
        /* =========================================== */
        /* üé® 1. ASOSIY STIL (Kontent uchun) */
        /* =========================================== */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background: linear-gradient(135deg, #eef3f7 0%, #dce4eb 100%);
            color: #333;
            min-height: 100vh;
            transition: background 0.5s, color 0.5s; 
        }
        header { 
            background: #0057b7; 
            color: white; 
            padding: 25px 20px; 
            text-align: center; 
            font-size: 32px; 
            font-weight: 900; 
            position: relative; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background 0.5s, box-shadow 0.5s;
        }

        /* üëá YANGI: CONTROL BAR STILI (Header ostida) */
        .controls-bar {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            padding: 10px 20px;
            background: #f0f4f7; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 900;
        }
        
        /* Mavzu almashtirgich */
        .theme-toggle { 
            padding: 8px 12px; 
            border-radius: 15px; 
            border: 2px solid #0057b7; 
            background: white; 
            color: #0057b7; 
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .theme-toggle:hover {
            background: #e6e6e6;
        }

        /* Til almashtirgich */
        .language-selector.flag-selector {
            display: flex;
            gap: 5px; 
            padding: 0;
        }

        .lang-btn {
            background: rgba(0, 87, 183, 0.1); 
            border: 2px solid transparent; 
            border-radius: 50%; 
            width: 38px;
            height: 38px;
            font-size: 18px;
            line-height: 1; 
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 0; 
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            color: black; 
        }
        .lang-btn.active-lang {
            border-color: #ffd700; 
            transform: scale(1.1);
            background: #0057b7; 
            color: white;
        }
        .lang-btn:hover:not(.active-lang) {
            transform: scale(1.05);
            background: rgba(0, 87, 183, 0.2);
        }
        /* üëÜ TIL VA MAVZU STILI */


        nav { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            background: white; 
            padding: 12px; 
            position: sticky; 
            top: 0; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2); 
            z-index: 1000; 
            flex-wrap: wrap; 
            transition: background 0.5s, box-shadow 0.5s;
        }
        nav button { 
            padding: 10px 15px; 
            border: none; 
            background: #0057b7; 
            color: white; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 15px; 
            font-weight: bold;
            transition: all 0.3s ease; 
            flex-grow: 1; 
            max-width: 150px;
        }
        nav button.active-btn {
            background: #003875;
            transform: scale(1.05);
        }

        .tools { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin: 25px; 
            flex-wrap: wrap; 
        }
        .tools input, .tools select { 
            padding: 12px 18px; 
            font-size: 16px; 
            border-radius: 25px; 
            border: 1px solid #ccc; 
            width: 250px; 
            max-width: 100%; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            box-sizing: border-box; 
            transition: all 0.5s;
        }
        #sorterSelect {
            width: 180px; 
        }

        .section { padding: 30px 15px; display: none; }
        .section.active { display: block; }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
            perspective: 1500px; 
        }
        
        .card { 
            background: white; 
            border-radius: 15px; 
            padding: 15px; 
            text-align: center; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            cursor: pointer; 
            height: 100%;
            text-decoration: none; 
            color: inherit; 
            
            opacity: 0;
            transform: translateY(50px);
            transition: none !important; 
            transform-style: preserve-3d; 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
            animation-fill-mode: forwards; 
        }
        
        .flag-img { 
            width: 100%; 
            height: 130px; 
            object-fit: cover; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            border: 3px solid #f0f0f0; 
            transition: transform 0.3s ease;
        }
        
        @keyframes staggered-entry {
            0% { opacity: 0; transform: translateY(50px) rotateX(10deg); }
            100% { opacity: 1; transform: translateY(0) rotateX(0); }
        }
        
        .card.stagger-in {
            animation: staggered-entry 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        /* Modal stil */
        .modal-bg {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
            justify-content: center;
            align-items: center;
        }
        .modal {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            animation: modal-open 0.3s ease-out;
            transition: background-color 0.5s, color 0.5s;
        }
        .modal h2 { margin-top: 0; color: #0057b7; font-size: 1.8rem; transition: color 0.5s; }
        
        /* =========================================== */
        /* üåô 2. DARK MODE STILI */
        /* =========================================== */
        
        body.dark-mode {
            background: linear-gradient(135deg, #121212 0%, #212121 100%);
            color: #f0f0f0; 
        }
        body.dark-mode header {
            background: #003366; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        /* DARK MODE CONTROL BAR STILI */
        body.dark-mode .controls-bar {
            background: #2c2c2c;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode .theme-toggle {
            border-color: #66b3ff;
            color: #f0f0f0;
            background: #3c3c3c;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        body.dark-mode .theme-toggle:hover {
            background: #4c4c4c;
        }

        /* Dark Mode uchun til tugmalari */
        body.dark-mode .lang-btn {
            background: #444; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            color: #f0f0f0; 
        }
        body.dark-mode .lang-btn.active-lang {
            border-color: #ffd700;
            background: #003366; 
        }
        body.dark-mode .lang-btn:hover:not(.active-lang) {
            background: #555;
        }
        body.dark-mode nav {
            background: #2c2c2c;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5); 
        }
        body.dark-mode .tools input, 
        body.dark-mode .tools select {
            background: #333;
            color: #f0f0f0;
            border-color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5); 
        }
        body.dark-mode .card {
            background: #2c2c2c;
            color: #f0f0f0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4); 
        }
        body.dark-mode .modal {
            background-color: #2c2c2c;
            color: #f0f0f0;
        }
        body.dark-mode .modal h2 {
            color: #66b3ff;
        }
        
        /* =========================================== */
        /* üöÄ 3. KIRISH EKRANI (MEDIA QUERIES) */
        /* =========================================== */
        #splashScreen {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1f2733 0%, #151a21 100%); 
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white; 
            text-align: center;
            opacity: 1;
            transition: opacity 0.5s ease-out 0.4s; 
            overflow: hidden; 
        }
        #splashScreen.fade-out {
            opacity: 0;
            pointer-events: none; 
        }
        #splashContent {
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease-out; 
        }
        #splashContent.fly-out {
            transform: scale(2.0) translateY(-100px); 
            opacity: 0; 
        }
        #splashScreen h1 {
            font-size: 3.5rem;
            margin-bottom: 5px;
            font-weight: 900;
            color: #00bcd4; 
            text-shadow: 0 4px 15px rgba(0, 188, 212, 0.3);
        }
        #splashScreen p {
            font-size: 1.5rem; 
            margin-bottom: 50px;
            font-weight: 400;
            color: #e0e0e0;
        }
        #startButton {
            padding: 18px 50px; 
            font-size: 1.4rem;
            font-weight: bold;
            border: none;
            background: #00bcd4; 
            color: #151a21; 
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(0, 188, 212, 0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @media (max-width: 768px) {
            #splashScreen h1 { font-size: 2.5rem; }
            #splashScreen p { font-size: 1.2rem; }
            #startButton { padding: 12px 25px; font-size: 1rem; }
            header { font-size: 24px; padding: 15px 10px; }
            
            /* üëá XATO TUZATILDI: Mobil telefon uchun Control Bar stillari */
            .controls-bar {
                flex-direction: column; 
                gap: 10px;
                padding: 10px; 
            }
            .theme-toggle {
                width: 100%; 
                max-width: 300px; 
                box-sizing: border-box; /* To'liq kenglik uchun muhim */
                margin-bottom: 5px; 
            }
        }
        
    </style>
</head>
<body>

<div id="splashScreen">
    <div id="splashContent">
        <h1>üåç DUNYO BAYROQLARI ATLASI</h1>
        <p>Interaktiv 3D Effektli Ma ºlumotnoma</p>
        <button id="startButton">Atlasni Ochish</button>
    </div>
</div>
<header>
    <span id="headerTitle">üåç Butun Dunyo Bayroqlari ‚Äî Super Mega Versiya</span>
</header>

<div class="controls-bar">
    <button class="theme-toggle" id="themeToggle">
        üåô Dark Mode
    </button>
    
    <div class="language-selector flag-selector" id="languageSelector">
        <button data-lang="uz" class="lang-btn">üá∫üáø</button>
        <button data-lang="en" class="lang-btn">üá¨üáß</button>
        <button data-lang="ru" class="lang-btn">üá∑üá∫</button>
        <button data-lang="cn" class="lang-btn">üá®üá≥</button>
        <button data-lang="kr" class="lang-btn">üá∞üá∑</button>
    </div>
</div>
<nav id="navBar">
    <button id="btnRasm" data-section="rasm" class="active-btn">üìò Rasmli</button>
    <button id="btnInfo" data-section="info">üìö Ma ºlumotli</button>
    <button id="btnEmoji" data-section="emoji">üòä Emoji</button>
</nav>

<div class="tools">
    <input type="text" id="searchInput" placeholder="üîç Davlat qidirish..." />
    <select id="filterSelect">
        <option value="all" data-lang-key="all_continents">üåé Barcha qit'alar</option>
        <option value="Asia" data-lang-key="asia">Osiyo</option>
        <option value="Europe" data-lang-key="europe">Yevropa</option>
        <option value="Africa" data-lang-key="africa">Afrika</option>
        <option value="North America" data-lang-key="north_america">Shimoliy Amerika</option>
        <option value="South America" data-lang-key="south_america">Janubiy Amerika</option>
        <option value="Oceania" data-lang-key="oceania">Okeaniya</option>
    </select>
    <select id="sorterSelect">
        <option value="name_uz" data-lang-key="sort_name">A-Z (Nom bo ªyicha)</option>
        <option value="population" data-lang-key="sort_population">Aholi bo ªyicha</option>
        <option value="area" data-lang-key="sort_area">Maydoni bo ªyicha</option>
    </select>
</div>

<div id="rasm" class="section active"><h2 data-lang-key="title_rasm">Rasmli Bayroqlar</h2><div class="grid" id="rasmGrid"></div></div>
<div id="info" class="section"><h2 data-lang-key="title_info">Ma ºlumotli Bayroqlar</h2><div class="grid" id="infoGrid"></div></div>
<div id="emoji" class="section"><h2 data-lang-key="title_emoji">Emoji Bayroqlar</h2><div class="grid" id="emojiGrid"></div></div>

<div id="modalBg" class="modal-bg">
    <div class="modal" id="modal"></div>
</div>

<script>
// ===========================================
// üõ†Ô∏è 3. KONSTANTALAR VA ELEMENTLAR
// ===========================================
const regionTranslations = {
    'Asia': { uz: 'Osiyo', en: 'Asia', ru: '–ê–∑–∏—è', cn: '‰∫öÊ¥≤', kr: 'ÏïÑÏãúÏïÑ' },
    'Europe': { uz: 'Yevropa', en: 'Europe', ru: '–ï–≤—Ä–æ–ø–∞', cn: 'Ê¨ßÊ¥≤', kr: 'Ïú†ÎüΩ' },
    'Africa': { uz: 'Afrika', en: 'Africa', ru: '–ê—Ñ—Ä–∏–∫–∞', cn: 'ÈùûÊ¥≤', kr: 'ÏïÑÌîÑÎ¶¨Ïπ¥' },
    'North America': { uz: 'Shimoliy Amerika', en: 'North America', ru: '–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞', cn: 'ÂåóÁæéÊ¥≤', kr: 'Î∂ÅÎØ∏' },
    'South America': { uz: 'Janubiy Amerika', en: 'South America', ru: '–Æ–∂–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞', cn: 'ÂçóÁæéÊ¥≤', kr: 'ÎÇ®ÎØ∏' },
    'Oceania': { uz: 'Okeaniya', en: 'Oceania', ru: '–û–∫–µ–∞–Ω–∏—è', cn: 'Â§ßÊ¥ãÊ¥≤', kr: 'Ïò§ÏÑ∏ÏïÑÎãàÏïÑ' }
};

const translations = {
    uz: {
        pageTitle: "üåç Butun Dunyo Bayroqlari ‚Äî Super Mega Versiya", headerTitle: "üåç Butun Dunyo Bayroqlari ‚Äî Super Mega Versiya",
        btn_rasm: "üìò Rasmli", btn_info: "üìö Ma ºlumotli", btn_emoji: "üòä Emoji",
        search_placeholder: "üîç Davlat qidirish...", all_continents: "üåé Barcha qit'alar",
        title_rasm: "Rasmli Bayroqlar", title_info: "Ma ºlumotli Bayroqlar", title_emoji: "Emoji Bayroqlar",
        modal_capital: "Poytaxt:", modal_continent: "Qit ºa:", modal_population: "Aholi:", modal_area: "Maydon:", modal_close: "Yopish",
        sort_name: "A-Z (Nom bo ªyicha)", sort_population: "Aholi bo ªyicha", sort_area: "Maydoni bo ªyicha"
    },
    en: { pageTitle: "World Flags Atlas", headerTitle: "World Flags Atlas ‚Äî Super Mega Version", btn_rasm: "üìò Image", btn_info: "üìö Data", btn_emoji: "üòä Emoji", search_placeholder: "üîç Search Country...", all_continents: "üåé All Continents", title_rasm: "Image Flags", title_info: "Data Flags", title_emoji: "Emoji Flags", modal_capital: "Capital:", modal_continent: "Continent:", modal_population: "Population:", modal_area: "Area:", modal_close: "Close", sort_name: "A-Z (By Name)", sort_population: "By Population", sort_area: "By Area" },
    ru: { pageTitle: "–ê—Ç–ª–∞—Å –§–ª–∞–≥–æ–≤ –ú–∏—Ä–∞", headerTitle: "–ê—Ç–ª–∞—Å –§–ª–∞–≥–æ–≤ –ú–∏—Ä–∞ ‚Äî –°—É–ø–µ—Ä –ú–µ–≥–∞ –í–µ—Ä—Å–∏—è", btn_rasm: "üìò –ò–∑–æ–±—Ä.", btn_info: "üìö –î–∞–Ω–Ω—ã–µ", btn_emoji: "üòä –≠–º–æ–¥–∑–∏", search_placeholder: "üîç –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞–Ω—ã...", all_continents: "üåé –í—Å–µ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã", title_rasm: "–§–ª–∞–≥–∏ (–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)", title_info: "–§–ª–∞–≥–∏ (–î–∞–Ω–Ω—ã–µ)", title_emoji: "–§–ª–∞–≥–∏ (–≠–º–æ–¥–∑–∏)", modal_capital: "–°—Ç–æ–ª–∏—Ü–∞:", modal_continent: "–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç:", modal_population: "–ù–∞—Å–µ–ª–µ–Ω–∏–µ:", modal_area: "–ü–ª–æ—â–∞–¥—å:", modal_close: "–ó–∞–∫—Ä—ã—Ç—å", sort_name: "–ê-–Ø (–ü–æ –∏–º–µ–Ω–∏)", sort_population: "–ü–æ –Ω–∞—Å–µ–ª–µ–Ω–∏—é", sort_area: "–ü–æ –ø–ª–æ—â–∞–¥–∏" },
    cn: { pageTitle: "‰∏ñÁïåÂõΩÊóóÂõæÈâ¥", headerTitle: "‰∏ñÁïåÂõΩÊóóÂõæÈâ¥ ‚Äî Ë∂ÖÁ∫ßÁâà", btn_rasm: "üìò ÂõæÂÉè", btn_info: "üìö Êï∞ÊçÆ", btn_emoji: "üòä Ë°®ÊÉÖ", search_placeholder: "üîç ÊêúÁ¥¢ÂõΩÂÆ∂...", all_continents: "üåé ÊâÄÊúâÂ§ßÊ¥≤", title_rasm: "ÂõæÂÉèÂõΩÊóó", title_info: "Êï∞ÊçÆÂõΩÊóó", title_emoji: "Ë°®ÊÉÖÂõΩÊóó", modal_capital: "È¶ñÈÉΩ:", modal_continent: "Â§ßÊ¥≤:", modal_population: "‰∫∫Âè£:", modal_area: "Èù¢ÁßØ:", modal_close: "ÂÖ≥Èó≠", sort_name: "A-Z (ÊåâÂêçÁß∞)", sort_population: "Êåâ‰∫∫Âè£", sort_area: "ÊåâÈù¢ÁßØ" },
    kr: { pageTitle: "ÏÑ∏Í≥Ñ Íµ≠Í∏∞ ÏïÑÌãÄÎùºÏä§", headerTitle: "ÏÑ∏Í≥Ñ Íµ≠Í∏∞ ÏïÑÌãÄÎùºÏä§ ‚Äî ÏäàÌçº Î©îÍ∞Ä Î≤ÑÏ†Ñ", btn_rasm: "üìò Ïù¥ÎØ∏ÏßÄ", btn_info: "üìö Ï†ïÎ≥¥", btn_emoji: "üòä Ïù¥Î™®Ìã∞ÏΩò", search_placeholder: "üîç Íµ≠Í∞Ä Í≤ÄÏÉâ...", all_continents: "üåé Î™®Îì† ÎåÄÎ•ô", title_rasm: "Ïù¥ÎØ∏ÏßÄ Íµ≠Í∏∞", title_info: "Ï†ïÎ≥¥ Íµ≠Í∏∞", title_emoji: "Ïù¥Î™®Ìã∞ÏΩò Íµ≠Í∏∞", modal_capital: "ÏàòÎèÑ:", modal_continent: "ÎåÄÎ•ô:", modal_population: "Ïù∏Íµ¨:", modal_area: "Î©¥Ï†Å:", modal_close: "Îã´Í∏∞", sort_name: "A-Z (Ïù¥Î¶ÑÏàú)", sort_population: "Ïù∏Íµ¨Ïàú", sort_area: "Î©¥Ï†ÅÏàú" }
};

const countries = [
    {name_uz:'O ªzbekiston', name_en:'Uzbekistan', name_ru:'–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', name_cn:'‰πåÂÖπÂà´ÂÖãÊñØÂù¶', name_kr:'Ïö∞Ï¶àÎ≤†ÌÇ§Ïä§ÌÉÑ', code:'uz', flag:'üá∫üáø', region:'Asia', capital:'Toshkent', population:36000000, area:'447,400 km¬≤'},
    {name_uz:'Xitoy', name_en:'China', name_ru:'–ö–∏—Ç–∞–π', name_cn:'‰∏≠ÂõΩ', name_kr:'Ï§ëÍµ≠', code:'cn', flag:'üá®üá≥', region:'Asia', capital:'Beijing', population:1425000000, area:'9,597,000 km¬≤'},
    {name_uz:'Hindiston', name_en:'India', name_ru:'–ò–Ω–¥–∏—è', name_cn:'Âç∞Â∫¶', name_kr:'Ïù∏ÎèÑ', code:'in', flag:'üáÆüá≥', region:'Asia', capital:'New Delhi', population:1428000000, area:'3,287,000 km¬≤'},
    {name_uz:'Yaponiya', name_en:'Japan', name_ru:'–Ø–ø–æ–Ω–∏—è', name_cn:'Êó•Êú¨', name_kr:'ÏùºÎ≥∏', code:'jp', flag:'üáØüáµ', region:'Asia', capital:'Tokyo', population:123000000, area:'377,975 km¬≤'},
    {name_uz:'Koreya Respublikasi', name_en:'South Korea', name_ru:'–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è', name_cn:'Èü©ÂõΩ', name_kr:'ÎåÄÌïúÎØºÍµ≠', code:'kr', flag:'üá∞üá∑', region:'Asia', capital:'Seoul', population:51700000, area:'100,210 km¬≤'},
    {name_uz:'Qozog ªiston', name_en:'Kazakhstan', name_ru:'–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', name_cn:'ÂìàËê®ÂÖãÊñØÂù¶', name_kr:'Ïπ¥ÏûêÌùêÏä§ÌÉÑ', code:'kz', flag:'üá∞üáø', region:'Asia', capital:'Astana', population:19000000, area:'2,725,000 km¬≤'},
    {name_uz:'Turkiya', name_en:'Turkey', name_ru:'–¢—É—Ä—Ü–∏—è', name_cn:'ÂúüËÄ≥ÂÖ∂', name_kr:'ÌÑ∞ÌÇ§', code:'tr', flag:'üáπüá∑', region:'Europe', capital:'Ankara', population:86000000, area:'783,562 km¬≤'},
    {name_uz:'Saudiya Arabistoni', name_en:'Saudi Arabia', name_ru:'–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è', name_cn:'Ê≤ôÁâπÈòøÊãâ‰ºØ', name_kr:'ÏÇ¨Ïö∞ÎîîÏïÑÎùºÎπÑÏïÑ', code:'sa', flag:'üá∏üá¶', region:'Asia', capital:'Riyadh', population:37000000, area:'2,150,000 km¬≤'},
    {name_uz:'Rossiya', name_en:'Russia', name_ru:'–†–æ—Å—Å–∏—è', name_cn:'‰øÑÁΩóÊñØ', name_kr:'Îü¨ÏãúÏïÑ', code:'ru', flag:'üá∑üá∫', region:'Europe', capital:'Moscow', population:144000000, area:'17,100,000 km¬≤'},
    {name_uz:'Buyuk Britaniya', name_en:'UK', name_ru:'–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', name_cn:'Ëã±ÂõΩ', name_kr:'ÏòÅÍµ≠', code:'gb', flag:'üá¨üáß', region:'Europe', capital:'London', population:67000000, area:'242,495 km¬≤'},
    {name_uz:'Fransiya', name_en:'France', name_ru:'–§—Ä–∞–Ω—Ü–∏—è', name_cn:'Ê≥ïÂõΩ', name_kr:'ÌîÑÎûëÏä§', code:'fr', flag:'üá´üá∑', region:'Europe', capital:'Paris', population:64800000, area:'551,695 km¬≤'},
    {name_uz:'Germaniya', name_en:'Germany', name_ru:'–ì–µ—Ä–º–∞–Ω–∏—è', name_cn:'Âæ∑ÂõΩ', name_kr:'ÎèÖÏùº', code:'de', flag:'üá©üá™', region:'Europe', capital:'Berlin', population:84000000, area:'357,588 km¬≤'},
    {name_uz:'Italiya', name_en:'Italy', name_ru:'–ò—Ç–∞–ª–∏—è', name_cn:'ÊÑèÂ§ßÂà©', name_kr:'Ïù¥ÌÉàÎ¶¨ÏïÑ', code:'it', flag:'üáÆüáπ', region:'Europe', capital:'Rome', population:58700000, area:'301,340 km¬≤'},
    {name_uz:'Ukraina', name_en:'Ukraine', name_ru:'–£–∫—Ä–∞–∏–Ω–∞', name_cn:'‰πåÂÖãÂÖ∞', name_kr:'Ïö∞ÌÅ¨ÎùºÏù¥ÎÇò', code:'ua', flag:'üá∫üá¶', region:'Europe', capital:'Kyiv', population:40000000, area:'603,628 km¬≤'},
    {name_uz:'Ispaniya', name_en:'Spain', name_ru:'–ò—Å–ø–∞–Ω–∏—è', name_cn:'Ë•øÁè≠Áâô', name_kr:'Ïä§ÌéòÏù∏', code:'es', flag:'üá™üá∏', region:'Europe', capital:'Madrid', population:47800000, area:'505,992 km¬≤'},
    {name_uz:'AQSH', name_en:'USA', name_ru:'–°–®–ê', name_cn:'ÁæéÂõΩ', name_kr:'ÎØ∏Íµ≠', code:'us', flag:'üá∫üá∏', region:'North America', capital:'Washington D.C.', population:340000000, area:'9,833,517 km¬≤'},
    {name_uz:'Kanada', name_en:'Canada', name_ru:'–ö–∞–Ω–∞–¥–∞', name_cn:'Âä†ÊãøÂ§ß', name_kr:'Ï∫êÎÇòÎã§', code:'ca', flag:'üá®üá¶', region:'North America', capital:'Ottawa', population:40000000, area:'9,984,670 km¬≤'},
    {name_uz:'Meksika', name_en:'Mexico', name_ru:'–ú–µ–∫—Å–∏–∫–∞', name_cn:'Â¢®Ë•øÂì•', name_kr:'Î©ïÏãúÏΩî', code:'mx', flag:'üá≤üáΩ', region:'North America', capital:'Mexico City', population:129000000, area:'1,964,375 km¬≤'},
    {name_uz:'Braziliya', name_en:'Brazil', name_ru:'–ë—Ä–∞–∑–∏–ª–∏—è', name_cn:'Â∑¥Ë•ø', name_kr:'Î∏åÎùºÏßà', code:'br', flag:'üáßüá∑', region:'South America', capital:'Brasilia', population:217000000, area:'8,515,767 km¬≤'},
    {name_uz:'Argentina', name_en:'Argentina', name_ru:'–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞', name_cn:'ÈòøÊ†πÂª∑', name_kr:'ÏïÑÎ•¥Ìó®Ìã∞ÎÇò', code:'ar', flag:'üá¶üá∑', region:'South America', capital:'Buenos Aires', population:46000000, area:'2,780,400 km¬≤'},
    {name_uz:'Misr', name_en:'Egypt', name_ru:'–ï–≥–∏–ø–µ—Ç', name_cn:'ÂüÉÂèä', name_kr:'Ïù¥ÏßëÌä∏', code:'eg', flag:'üá™üá¨', region:'Africa', capital:'Cairo', population:114000000, area:'1,002,450 km¬≤'},
    {name_uz:'Nigeriya', name_en:'Nigeria', name_ru:'–ù–∏–≥–µ—Ä–∏—è', name_cn:'Â∞ºÊó•Âà©‰∫ö', name_kr:'ÎÇòÏù¥ÏßÄÎ¶¨ÏïÑ', code:'ng', flag:'üá≥üá¨', region:'Africa', capital:'Abuja', population:230000000, area:'923,768 km¬≤'},
    {name_uz:'Janubiy Afrika', name_en:'South Africa', name_ru:'–Æ–∂–Ω–∞—è –ê—Ñ—Ä–∏–∫–∞', name_cn:'ÂçóÈùû', name_kr:'ÎÇ®ÏïÑÌîÑÎ¶¨Ïπ¥', code:'za', flag:'üáøüá¶', region:'Africa', capital:'Pretoria', population:62000000, area:'1,221,037 km¬≤'},
    {name_uz:'Avstraliya', code:'au', flag:'üá¶üá∫', region:'Oceania', capital:'Canberra', name_en:'Australia', name_ru:'–ê–≤—Å—Ç—Ä–∞–ª–∏—è', name_cn:'Êæ≥Â§ßÂà©‰∫ö', name_kr:'Ìò∏Ï£º', population:27000000, area:'7,692,024 km¬≤'},
    {name_uz:'Yangi Zelandiya', code:'nz', flag:'üá≥üáø', region:'Oceania', capital:'Wellington', name_en:'New Zealand', name_ru:'–ù–æ–≤–∞—è –ó–µ–ª–∞–Ω–¥–∏—è', name_cn:'Êñ∞Ë•øÂÖ∞', kr:'Îâ¥ÏßàÎûúÎìú', population:5300000, area:'268,021 km¬≤'},
    {name_uz:'Qirg ªiziston', name_en:'Kyrgyzstan', name_ru:'–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', name_cn:'ÂêâÂ∞îÂêâÊñØÊñØÂù¶', name_kr:'ÌÇ§Î•¥Í∏∞Ïä§Ïä§ÌÉÑ', code:'kg', flag:'üá∞üá¨', region:'Asia', capital:'Bishkek', population:7000000, area:'199,900 km¬≤'},
    {name_uz:'Tojikiston', name_en:'Tajikistan', name_ru:'–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω', name_cn:'Â°îÂêâÂÖãÊñØÂù¶', name_kr:'ÌÉÄÏßÄÌÇ§Ïä§ÌÉÑ', code:'tj', flag:'üáπüáØ', region:'Asia', capital:'Dushanbe', population:10000000, area:'143,100 km¬≤'},
    {name_uz:'Turkmaniston', name_en:'Turkmenistan', name_ru:'–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω', name_cn:'ÂúüÂ∫ìÊõºÊñØÂù¶', name_kr:'Ìà¨Î•¥ÌÅ¨Î©îÎãàÏä§ÌÉÑ', code:'tm', flag:'üáπüá≤', region:'Asia', capital:'Ashgabat', population:7000000, area:'488,100 km¬≤'},
    {name_uz:'Afg ªoniston', name_en:'Afghanistan', name_ru:'–ê—Ñ–≥–∞–Ω–∏—Å—Ç–∞–Ω', name_cn:'ÈòøÂØåÊ±ó', name_kr:'ÏïÑÌîÑÍ∞ÄÎãàÏä§ÌÉÑ', code:'af', flag:'üá¶üá´', region:'Asia', capital:'Kabul', population:41000000, area:'652,860 km¬≤'},
    {name_uz:'Armaniston', name_en:'Armenia', name_ru:'–ê—Ä–º–µ–Ω–∏—è', name_cn:'‰∫öÁæéÂ∞º‰∫ö', name_kr:'ÏïÑÎ•¥Î©îÎãàÏïÑ', code:'am', flag:'üá¶üá≤', region:'Asia', capital:'Yerevan', population:3000000, area:'29,743 km¬≤'},
    {name_uz:'Ozarbayjon', name_en:'Azerbaijan', name_ru:'–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω', name_cn:'ÈòøÂ°ûÊãúÁñÜ', name_kr:'ÏïÑÏ†úÎ•¥Î∞îÏù¥Ïûî', code:'az', flag:'üá¶üáø', region:'Asia', capital:'Baku', population:10000000, area:'86,600 km¬≤'},
    {name_uz:'Filippin', name_en:'Philippines', name_ru:'–§–∏–ª–∏–ø–ø–∏–Ω—ã', name_cn:'Ëè≤ÂæãÂÆæ', name_kr:'ÌïÑÎ¶¨ÌïÄ', code:'ph', flag:'üáµüá≠', region:'Asia', capital:'Manila', population:118000000, area:'300,000 km¬≤'},
    {name_uz:'Pokiston', name_en:'Pakistan', name_ru:'–ü–∞–∫–∏—Å—Ç–∞–Ω', name_cn:'Â∑¥Âü∫ÊñØÂù¶', name_kr:'ÌååÌÇ§Ïä§ÌÉÑ', code:'pk', flag:'üáµüá∞', region:'Asia', capital:'Islamabad', population:240000000, area:'881,913 km¬≤'},
    {name_uz:'Vyetnam', name_en:'Vietnam', name_ru:'–í—å–µ—Ç–Ω–∞–º', name_cn:'Ë∂äÂçó', name_kr:'Î≤†Ìä∏ÎÇ®', code:'vn', flag:'üáªüá≥', region:'Asia', capital:'Hanoi', population:99000000, area:'331,212 km¬≤'},
    {name_uz:'Indoneziya', name_en:'Indonesia', name_ru:'–ò–Ω–¥–æ–Ω–µ–∑–∏—è', name_cn:'Âç∞Â∫¶Â∞ºË•ø‰∫ö', name_kr:'Ïù∏ÎèÑÎÑ§ÏãúÏïÑ', code:'id', flag:'üáÆüá©', region:'Asia', capital:'Jakarta', population:277000000, area:'1,904,569 km¬≤'},
    {name_uz:'Keniya', name_en:'Kenya', name_ru:'–ö–µ–Ω–∏—è', name_cn:'ËÇØÂ∞º‰∫ö', name_kr:'ÏºÄÎÉê', code:'ke', flag:'üá∞üá™', region:'Africa', capital:'Nairobi', population:56000000, area:'580,367 km¬≤'},
    {name_uz:'Gana', name_en:'Ghana', name_ru:'–ì–∞–Ω–∞', name_cn:'Âä†Á∫≥', kr:'Í∞ÄÎÇò', code:'gh', flag:'üá¨üá≠', region:'Africa', capital:'Accra', population:34000000, area:'238,533 km¬≤'},
    {name_uz:'Shvetsiya', name_en:'Sweden', name_ru:'–®–≤–µ—Ü–∏—è', name_cn:'ÁëûÂÖ∏', name_kr:'Ïä§Ïõ®Îç¥', code:'se', flag:'üá∏üá™', region:'Europe', capital:'Stockholm', population:10500000, area:'450,295 km¬≤'},
    {name_uz:'Shveytsariya', name_en:'Switzerland', name_ru:'–®–≤–µ–π—Ü–∞—Ä–∏—è', name_cn:'ÁëûÂ£´', name_kr:'Ïä§ÏúÑÏä§', code:'ch', flag:'üá®üá≠', region:'Europe', capital:'Bern', population:8800000, area:'41,285 km¬≤'},
    {name_uz:'Gvatemala', name_en:'Guatemala', name_ru:'–ì–≤–∞—Ç–µ–º–∞–ª–∞', name_cn:'Âç±Âú∞È©¨Êãâ', name_kr:'Í≥ºÌÖåÎßêÎùº', code:'gt', flag:'üá¨üáπ', region:'North America', capital:'Guatemala City', population:18000000, area:'108,889 km¬≤'},
    {name_uz:'Chili', name_en:'Chile', name_ru:'–ß–∏–ª–∏', name_cn:'Êô∫Âà©', name_kr:'Ïπ†Î†à', code:'cl', flag:'üá®üá±', region:'South America', capital:'Santiago', population:19700000, area:'756,102 km¬≤'},
    {name_uz:'Paragvay', name_en:'Paraguay', name_ru:'–ü–∞—Ä–∞–≥–≤–∞–π', name_cn:'Â∑¥ÊãâÂú≠', name_kr:'ÌååÎùºÍ≥ºÏù¥', code:'py', flag:'üáµüáæ', region:'South America', capital:'Asunci√≥n', population:6800000, area:'406,752 km¬≤'},
    {name_uz:'Singapur', name_en:'Singapore', name_ru:'–°–∏–Ω–≥–∞–ø—É—Ä', name_cn:'Êñ∞Âä†Âù°', name_kr:'Ïã±Í∞ÄÌè¨Î•¥', code:'sg', flag:'üá∏üá¨', region:'Asia', capital:'Singapore', population:6000000, area:'710 km¬≤'},
    {name_uz:'Tailand', name_en:'Thailand', name_ru:'–¢–∞–∏–ª–∞–Ω–¥', name_cn:'Ê≥∞ÂõΩ', name_kr:'ÌÉúÍµ≠', code:'th', flag:'üáπüá≠', region:'Asia', capital:'Bangkok', population:71000000, area:'513,120 km¬≤'},
    {name_uz:'Eron', name_en:'Iran', name_ru:'–ò—Ä–∞–Ω', name_cn:'‰ºäÊúó', name_kr:'Ïù¥ÎûÄ', code:'ir', flag:'üáÆüá∑', region:'Asia', capital:'Tehran', population:89000000, area:'1,648,195 km¬≤'},
    {name_uz:'Iroq', name_en:'Iraq', name_ru:'–ò—Ä–∞–∫', name_cn:'‰ºäÊãâÂÖã', name_kr:'Ïù¥ÎùºÌÅ¨', code:'iq', flag:'üáÆüá∂', region:'Asia', capital:'Baghdad', population:46000000, area:'438,317 km¬≤'},
    {name_uz:'Isroil', name_en:'Israel', name_ru:'–ò–∑—Ä–∞–∏–ª—å', name_cn:'‰ª•Ëâ≤Âàó', name_kr:'Ïù¥Ïä§ÎùºÏóò', code:'il', flag:'üáÆüá±', region:'Asia', capital:'Jerusalem', population:9900000, area:'22,072 km¬≤'},
    {name_uz:'Malayziya', name_en:'Malaysia', name_ru:'–ú–∞–ª–∞–π–∑–∏—è', name_cn:'È©¨Êù•Ë•ø‰∫ö', name_kr:'ÎßêÎ†àÏù¥ÏãúÏïÑ', code:'my', flag:'üá≤üáæ', region:'Asia', capital:'Kuala Lumpur', population:34000000, area:'330,803 km¬≤'},
    {name_uz:'Bangladesh', name_en:'Bangladesh', name_ru:'–ë–∞–Ω–≥–ª–∞–¥–µ—à', name_cn:'Â≠üÂä†ÊãâÂõΩ', name_kr:'Î∞©Í∏ÄÎùºÎç∞Ïãú', code:'bd', flag:'üáßüá©', region:'Asia', capital:'Dhaka', population:174000000, area:'147,570 km¬≤'},
    {name_uz:'Nepal', name_en:'Nepal', name_ru:'–ù–µ–ø–∞–ª', name_cn:'Â∞ºÊ≥äÂ∞î', name_kr:'ÎÑ§Ìåî', code:'np', flag:'üá≥üáµ', region:'Asia', capital:'Kathmandu', population:30000000, area:'147,181 km¬≤'},
    {name_uz:'Gretsiya', name_en:'Greece', name_ru:'–ì—Ä–µ—Ü–∏—è', name_cn:'Â∏åËÖä', name_kr:'Í∑∏Î¶¨Ïä§', code:'gr', flag:'üá¨üá∑', region:'Europe', capital:'Athens', population:10400000, area:'131,957 km¬≤'},
    {name_uz:'Polsha', name_en:'Poland', name_ru:'–ü–æ–ª—å—à–∞', name_cn:'Ê≥¢ÂÖ∞', kr:'Ìè¥ÎûÄÎìú', code:'pl', flag:'üáµüá±', region:'Europe', capital:'Warsaw', population:37700000, area:'312,696 km¬≤'},
    {name_uz:'Ruminiya', name_en:'Romania', name_ru:'–†—É–º—ã–Ω–∏—è', name_cn:'ÁΩóÈ©¨Â∞º‰∫ö', name_kr:'Î£®ÎßàÎãàÏïÑ', code:'ro', flag:'üá∑üá¥', region:'Europe', capital:'Bucharest', population:19000000, area:'238,397 km¬≤'},
    {name_uz:'Niderlandiya', name_en:'Netherlands', name_ru:'–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã', name_cn:'Ëç∑ÂÖ∞', name_kr:'ÎÑ§ÎçúÎûÄÎìú', code:'nl', flag:'üá≥üá±', region:'Europe', capital:'Amsterdam', population:17800000, area:'41,850 km¬≤'},
    {name_uz:'Belgiya', name_en:'Belgium', name_ru:'–ë–µ–ª—å–≥–∏—è', name_cn:'ÊØîÂà©Êó∂', name_kr:'Î≤®Í∏∞Ïóê', code:'be', flag:'üáßüá™', region:'Europe', capital:'Brussels', population:11800000, area:'30,689 km¬≤'},
    {name_uz:'Portugaliya', name_en:'Portugal', name_ru:'–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è', name_cn:'Ëë°ËêÑÁâô', name_kr:'Ìè¨Î•¥Ìà¨Í∞à', code:'pt', flag:'üáµüáπ', region:'Europe', capital:'Lisbon', population:10400000, area:'92,212 km¬≤'},
    {name_uz:'Avstriya', name_en:'Austria', name_ru:'–ê–≤—Å—Ç—Ä–∏—è', name_cn:'Â••Âú∞Âà©', name_kr:'Ïò§Ïä§Ìä∏Î¶¨ÏïÑ', code:'at', flag:'üá¶üáπ', region:'Europe', capital:'Vienna', population:9100000, area:'83,879 km¬≤'},
    {name_uz:'Vengriya', name_en:'Hungary', name_ru:'–í–µ–Ω–≥—Ä–∏—è', name_cn:'ÂåàÁâôÂà©', name_kr:'ÌóùÍ∞ÄÎ¶¨', code:'hu', flag:'üá≠üá∫', region:'Europe', capital:'Budapest', population:9600000, area:'93,030 km¬≤'},
    {name_uz:'Marokash', name_en:'Morocco', name_ru:'–ú–∞—Ä–æ–∫–∫–æ', name_cn:'Êë©Ê¥õÂì•', name_kr:'Î™®Î°úÏΩî', code:'ma', flag:'üá≤üá¶', region:'Africa', capital:'Rabat', population:38000000, area:'446,550 km¬≤'},
    {name_uz:'Jazoir', name_en:'Algeria', name_ru:'–ê–ª–∂–∏—Ä', name_cn:'ÈòøÂ∞îÂèäÂà©‰∫ö', name_kr:'ÏïåÏ†úÎ¶¨', code:'dz', flag:'üá©üáø', region:'Africa', capital:'Algiers', population:47000000, area:'2,381,741 km¬≤'},
    {name_uz:'Kongo (DRK)', name_en:'DR Congo', name_ru:'–î–† –ö–æ–Ω–≥–æ', name_cn:'ÂàöÊûúÔºàÈáëÔºâ', name_kr:'ÏΩ©Í≥†ÎØºÏ£ºÍ≥µÌôîÍµ≠', code:'cd', flag:'üá®üá©', region:'Africa', capital:'Kinshasa', population:105000000, area:'2,345,410 km¬≤'},
    {name_uz:'Efiopiya', name_en:'Ethiopia', name_ru:'–≠—Ñ–∏–æ–ø–∏—è', name_cn:'ÂüÉÂ°û‰øÑÊØî‰∫ö', name_kr:'ÏóêÌã∞Ïò§ÌîºÏïÑ', code:'et', flag:'üá™üáπ', region:'Africa', capital:'Addis Ababa', population:128000000, area:'1,104,300 km¬≤'},
    {name_uz:'Tanzaniya', name_en:'Tanzania', name_ru:'–¢–∞–Ω–∑–∞–Ω–∏—è', name_cn:'Âù¶Ê°ëÂ∞º‰∫ö', name_kr:'ÌÉÑÏûêÎãàÏïÑ', code:'tz', flag:'üáπüáø', region:'Africa', capital:'Dodoma', population:68000000, area:'947,303 km¬≤'},
    {name_uz:'Puerto-Riko', name_en:'Puerto Rico', name_ru:'–ü—É—ç—Ä—Ç–æ-–†–∏–∫–æ', name_cn:'Ê≥¢Â§öÈªéÂêÑ', name_kr:'Ìë∏ÏóêÎ•¥ÌÜ†Î¶¨ÏΩî', code:'pr', flag:'üáµüá∑', region:'North America', capital:'San Juan', population:3200000, area:'8,870 km¬≤'},
    {name_uz:'Kuba', name_en:'Cuba', name_ru:'–ö—É–±–∞', name_cn:'Âè§Â∑¥', name_kr:'Ïø†Î∞î', code:'cu', flag:'üá®üá∫', region:'North America', capital:'Havana', population:11000000, area:'109,884 km¬≤'},
    {name_uz:'Kolumbiya', name_en:'Colombia', name_ru:'–ö–æ–ª—É–º–±–∏—è', name_cn:'Âì•‰º¶ÊØî‰∫ö', name_kr:'ÏΩúÎ°¨ÎπÑÏïÑ', code:'co', flag:'üá®üá¥', region:'South America', capital:'Bogot√°', population:52000000, area:'1,141,748 km¬≤'},
    {name_uz:'Peru', name_en:'Peru', ru:'–ü–µ—Ä—É', cn:'ÁßòÈ≤Å', kr:'ÌéòÎ£®', code:'pe', flag:'üáµüá™', region:'South America', capital:'Lima', population:34000000, area:'1,285,216 km¬≤'},
    {name_uz:'Venesuela', name_en:'Venezuela', name_ru:'–í–µ–Ω–µ—Å—É—ç–ª–∞', name_cn:'ÂßîÂÜÖÁëûÊãâ', name_kr:'Î≤†ÎÑ§ÏàòÏóòÎùº', code:'ve', flag:'üáªüá™', region:'South America', capital:'Caracas', population:29000000, area:'916,445 km¬≤'},
    {name_uz:'Fiji', name_en:'Fiji', name_ru:'–§–∏–¥–∂–∏', name_cn:'ÊñêÊµé', name_kr:'ÌîºÏßÄ', code:'fj', flag:'üá´üáØ', region:'Oceania', capital:'Suva', population:900000, area:'18,272 km¬≤'},
    {name_uz:'Samoa', name_en:'Samoa', name_ru:'–°–∞–º–æ–∞', name_cn:'Ëê®Êë©‰∫ö', name_kr:'ÏÇ¨Î™®ÏïÑ', code:'ws', flag:'üáºüá∏', region:'Oceania', capital:'Apia', population:220000, area:'2,842 km¬≤'},
];


let currentLang = 'uz'; 

const body = document.body; 
const themeToggle = document.getElementById('themeToggle'); 
const langSelector = document.getElementById('languageSelector'); 
const rasmGrid = document.getElementById('rasmGrid');
const infoGrid = document.getElementById('infoGrid');
const emojiGrid = document.getElementById('emojiGrid');
const modalBg = document.getElementById('modalBg');
const modal = document.getElementById('modal');
const searchInput = document.getElementById('searchInput');
const filterSelect = document.getElementById('filterSelect');
const sorterSelect = document.getElementById('sorterSelect');
const navBar = document.getElementById('navBar');
const splashScreen = document.getElementById('splashScreen');
const startButton = document.getElementById('startButton');
const splashContent = document.getElementById('splashContent'); 

// ===========================================
// üõ†Ô∏è 4. FUNKSIYALAR
// ===========================================

function formatPopulation(num) {
    if (typeof num === 'number') {
        const locale = currentLang === 'cn' ? 'zh-CN' : currentLang === 'kr' ? 'ko-KR' : 'en-US'; 
        return num.toLocaleString(locale);
    }
    return num;
}

// üåô MAVZUNI YUKLASH VA ALMASHTIRISH
function toggleTheme() {
    body.classList.toggle('dark-mode');
    
    const isDarkMode = body.classList.contains('dark-mode');
    
    themeToggle.innerHTML = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
    
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
}

function loadTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
        themeToggle.innerHTML = '‚òÄÔ∏è Light Mode';
    } else {
        themeToggle.innerHTML = 'üåô Dark Mode';
    }
}


function translateUI() {
    const lang = translations[currentLang];
    
    document.getElementById('pageTitle').textContent = lang.pageTitle;
    document.getElementById('headerTitle').textContent = lang.headerTitle;
    
    navBar.querySelectorAll('button').forEach(btn => {
        const key = `btn_${btn.dataset.section}`;
        if (lang[key]) btn.textContent = lang[key];
    });
    
    searchInput.placeholder = lang.search_placeholder;
    
    filterSelect.querySelectorAll('option').forEach(option => {
        const key = option.getAttribute('data-lang-key');
        if (option.value !== 'all' && regionTranslations[option.value]) {
            option.textContent = regionTranslations[option.value][currentLang] || option.value;
        } else if (lang[key]) {
             option.textContent = lang[key];
        }
    });

    sorterSelect.querySelectorAll('option').forEach(option => {
        const key = option.getAttribute('data-lang-key');
        if (key && lang[key]) {
             option.textContent = lang[key];
        }
    });

    document.querySelectorAll('.section h2').forEach(h2 => {
        const key = h2.getAttribute('data-lang-key');
        if (key && lang[key]) {
            h2.textContent = lang[key];
        }
    });

    if (splashScreen.style.display === 'none') {
        filterCountries();
    }
}

function setLanguage(langCode) {
    currentLang = langCode;
    translateUI();
    
    // Faol til tugmasini belgilash
    langSelector.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active-lang');
        if (btn.dataset.lang === langCode) {
            btn.classList.add('active-lang');
        }
    });
}


function staggerAnimateCards(gridElement) {
    const cards = gridElement.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.classList.remove('stagger-in');
        
        setTimeout(() => {
            const delay = (index % 10) * 50; 
            
            card.style.animationDelay = `${delay}ms`;
            card.classList.add('stagger-in');
        }, 100); 
    });
}


function fillGrids(list) {
    const nameKey = `name_${currentLang}`;
    const lang = translations[currentLang];

    const generateCardHtml = (c, type) => {
        const regionName = regionTranslations[c.region][currentLang] || c.region; 
        let content = '';
        const cardNameAttr = c.name_uz.replace(/'/g, "\\'"); 

        if (type === 'rasm' || type === 'info') {
            content = `<img class='flag-img' src='https://flagcdn.com/w320/${c.code}.png' alt='${c.name_uz} bayrog ªi' onerror="this.onerror=null; this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'; this.outerHTML='<div class=\\'emoji-flag flag-img-error\\'>üåê</div>'">`;
        } else if (type === 'emoji') {
            content = `<div class='emoji-flag'>${c.flag}</div>`;
        }
        
        let infoHtml = '';
        if (type === 'info') {
            infoHtml = `
                <div>${lang.modal_continent} ${regionName}</div>
                <div>${lang.modal_capital} ${c.capital}</div>
                <div>${lang.modal_population} ${formatPopulation(c.population)}</div>
            `;
        }

        return `
            <a href="#" class='card' data-country-name='${cardNameAttr}' onclick='event.preventDefault(); openModal("${cardNameAttr}")'>
                ${content}
                <div class='name'>${c[nameKey] || c.name_uz}</div>
                ${infoHtml}
            </a>`;
    };

    const rasmHtml = list.map(c => generateCardHtml(c, 'rasm')).join('');
    const infoHtml = list.map(c => generateCardHtml(c, 'info')).join(''); 
    const emojiHtml = list.map(c => generateCardHtml(c, 'emoji')).join('');

    rasmGrid.innerHTML = rasmHtml;
    infoGrid.innerHTML = infoHtml;
    emojiGrid.innerHTML = emojiHtml;
    
    staggerAnimateCards(rasmGrid);
    staggerAnimateCards(infoGrid);
    staggerAnimateCards(emojiGrid);
}

function filterCountries() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedRegion = filterSelect.value;
    const sortBy = sorterSelect.value; 
    const nameKey = `name_${currentLang}`; 
    const uzNameKey = 'name_uz';

    let filteredList = countries.filter(country => {
        const countryNameInLang = country[nameKey] || country[uzNameKey];
        const matchesSearch = countryNameInLang.toLowerCase().includes(searchTerm) || 
                              country[uzNameKey].toLowerCase().includes(searchTerm) ||
                              country.capital.toLowerCase().includes(searchTerm);

        const matchesRegion = selectedRegion === 'all' || country.region === selectedRegion;

        return matchesSearch && matchesRegion;
    });

    filteredList.sort((a, b) => {
        if (sortBy === 'population') {
            return b.population - a.population; 
        } else if (sortBy === 'area') {
            const areaA = parseFloat(a.area.replace(/[^\d.]/g, ''));
            const areaB = parseFloat(b.area.replace(/[^\d.]/g, ''));
            
            return areaB - areaA;
        } else if (sortBy === 'name_uz') {
            const nameA = (a[uzNameKey] || '').toLowerCase();
            const nameB = (b[uzNameKey] || '').toLowerCase();
            
            if (nameA < nameB) return -1;
            if (nameA > nameB) return 1;
            return 0;
        }
        return 0; 
    });

    fillGrids(filteredList);
}

function openModal(countryNameUz) {
    const country = countries.find(c => c.name_uz === countryNameUz);
    const nameKey = `name_${currentLang}`;
    const lang = translations[currentLang];
    
    if (!country) return;

    const regionName = regionTranslations[country.region][currentLang] || country.region; 

    modal.innerHTML = `
        <h2>${country[nameKey] || country.name_uz}</h2>
        <img src='https://flagcdn.com/w320/${country.code}.png' alt='${country.name_uz} flag'>
        <p><strong>${lang.modal_capital}</strong> ${country.capital}</p>
        <p><strong>${lang.modal_continent}</strong> ${regionName}</p>
        <p><strong>${lang.modal_population}</strong> ${formatPopulation(country.population)}</p>
        <p><strong>${lang.modal_area}</strong> ${country.area}</p>
        <button class='close' onclick='closeModal()'>${lang.modal_close}</button>
    `;

    modalBg.style.display = 'flex';
}

function closeModal() {
    modalBg.style.display = 'none';
}

function showSection(sectionId, button) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
        section.style.display = 'none';
    });
    
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('active');
    }

    navBar.querySelectorAll('button').forEach(btn => {
        btn.classList.remove('active-btn');
    });
    button.classList.add('active-btn');
    
    const activeGrid = targetSection.querySelector('.grid');
    if(activeGrid) {
        activeGrid.querySelectorAll('.card').forEach(card => card.classList.remove('stagger-in'));
        staggerAnimateCards(activeGrid);
    }
}


// ===========================================
// üöÄ 7. INITSALIZATSIYA (DOMContent Loaded)
// ===========================================

function initializeApp() {
    // üåô Mavzuni yuklash
    loadTheme();
    
    // Boshlang'ich tilni o'rnatish (Uzbek)
    const initialLang = 'uz'; 
    sorterSelect.value = 'name_uz'; 
    setLanguage(initialLang); 

    const initialButton = document.querySelector('#navBar button[data-section="rasm"]');
    if (initialButton) {
        showSection('rasm', initialButton);
    }

    // üëá KIRISH EKRANI ANIMATSIYASI 
    startButton.addEventListener('click', () => {
        splashContent.classList.add('fly-out'); 
        splashScreen.classList.add('fade-out'); 
        
        setTimeout(() => {
            splashScreen.style.display = 'none';
            filterCountries(); 
        }, 1100); 
    });

    // Event tinglovchilar
    
    // Til almashtirgich uchun tinglovchi 
    langSelector.addEventListener('click', (e) => {
        const button = e.target.closest('.lang-btn');
        if (button && button.dataset.lang) {
            setLanguage(button.dataset.lang);
        }
    });

    // Mavzu almashtirgich
    themeToggle.addEventListener('click', toggleTheme); 
    
    navBar.addEventListener('click', (e) => {
        const button = e.target.closest('button');
        if (button && button.dataset.section) {
            showSection(button.dataset.section, button);
        }
    });
    searchInput.addEventListener('input', filterCountries);
    filterSelect.addEventListener('change', filterCountries);
    sorterSelect.addEventListener('change', filterCountries); 
    modalBg.addEventListener('click', (e) => {
        if (e.target.id === 'modalBg') {
            closeModal();
        }
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalBg.style.display === 'flex') {
            closeModal();
        }
    });
}

document.addEventListener('DOMContentLoaded', initializeApp);
</script>

</body>
</html>
